

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fisher.fisher_forecast &mdash; ngEHTforecast 0+untagged.63.g94a6842.dirty documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/ngeht.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="ngEHTforecast 0+untagged.63.g94a6842.dirty documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../docs/src/index.html" class="icon icon-home"> ngEHTforecast
          

          
            
            <img src="../../_static/ngeht_construction.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0+untagged.63.g94a6842.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/userguide.html">User’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/devel.html">Developer’s Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../docs/src/index.html">ngEHTforecast</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="../../docs/src/index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>fisher.fisher_forecast</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fisher.fisher_forecast</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.special</span> <span class="k">as</span> <span class="nn">ss</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span> <span class="k">as</span> <span class="nn">si</span>
<span class="kn">import</span> <span class="nn">ehtim</span> <span class="k">as</span> <span class="nn">eh</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">themispy</span> <span class="k">as</span> <span class="nn">ty</span>
<span class="kn">import</span> <span class="nn">ehtim.parloop</span> <span class="k">as</span> <span class="nn">ploop</span>

<span class="c1"># import scipy.linalg as linalg</span>
<span class="kn">import</span> <span class="nn">numpy.linalg</span> <span class="k">as</span> <span class="nn">linalg</span>

<span class="k">def</span> <span class="nf">_print_matrix</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39; </span><span class="si">%10.3g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_print_vector</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39; </span><span class="si">%10.3g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_invert_matrix</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">return</span> <span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="c1"># return linalg.pinvh(a)</span>
    <span class="c1"># n = a.shape[0]</span>
    <span class="c1"># I = np.identity(n)</span>
    <span class="c1"># return linalg.solve(a, I, sym_pos = True, overwrite_b = True)</span>

    
<div class="viewcode-block" id="FisherForecast"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast">[docs]</a><span class="k">class</span> <span class="nc">FisherForecast</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class that collects and contains information for making Fisher-matrix type</span>
<span class="sd">    forecasts for observations of various types.  Forms a base class for fully</span>
<span class="sd">    analytical versions that may be application specific.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      size (int): Number of parameters expected by this model.</span>
<span class="sd">      stokes (str): If this is a Stokes I model (&#39;I&#39;) or a polarized model (&#39;full&#39;).</span>
<span class="sd">      prior_sigma_list (list): List of standard deviations associated with the parameter priors.</span>
<span class="sd">      covar (np.ndarray): Internal space for the computation of the covariance matrix.</span>
<span class="sd">      argument_hash (str): MD5 hash object indicating last state of covariance computation. Used to determine if the covariance needs to be recomputed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="s1">&#39;I&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covar</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">default_color_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span><span class="s1">&#39;purple&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_cmap_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Reds_r&#39;</span><span class="p">,</span><span class="s1">&#39;Blues_r&#39;</span><span class="p">,</span><span class="s1">&#39;Greens_r&#39;</span><span class="p">,</span><span class="s1">&#39;Oranges_r&#39;</span><span class="p">,</span><span class="s1">&#39;Purples_r&#39;</span><span class="p">]</span>

        
<div class="viewcode-block" id="FisherForecast.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        User-defined function in child classes that generates visibilities </span>
<span class="sd">        associated with a given model image object.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (Obsdata): An ehtim Obsdata object with a particular set of observation details (u,v positions, times, etc.)</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          V (np.array): list of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;visibilities function not implemented in base class!&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">*</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span></div>

            
<div class="viewcode-block" id="FisherForecast.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        User-defined function in child classes that generates visibility gradients</span>
<span class="sd">        associated with a given model image object.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (Obsdata): An ehtim Obsdata object with a particular set of observation details (u,v positions, times, etc.)</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          gradV (np.ndarray): list of complex visibilities gradients computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;visibility_gradients function not implemented in base class!&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">*</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="FisherForecast.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        User-defined function in child classes that returns a list of</span>
<span class="sd">        of parameter labels to be used in plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          plabels (list): list of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;parameter_labels function not implemented in base class!&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[]</span></div>

    
<div class="viewcode-block" id="FisherForecast.add_gaussian_prior"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.add_gaussian_prior">[docs]</a>    <span class="k">def</span> <span class="nf">add_gaussian_prior</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pindex</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a Gaussian prior on the parameter with the specified index.</span>

<span class="sd">        Args:</span>
<span class="sd">          pindex (int): Index of the parameter on which to place the prior.</span>
<span class="sd">          sigma (float): Standard deviation of the Gaussian prior to apply.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">pindex</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Parameter </span><span class="si">%i</span><span class="s2"> does not exist, expected in [0,</span><span class="si">%i</span><span class="s2">].&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">pindex</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">*</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">[</span><span class="n">pindex</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="kc">None</span></div>
        
        
<div class="viewcode-block" id="FisherForecast.add_gaussian_prior_list"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.add_gaussian_prior_list">[docs]</a>    <span class="k">def</span> <span class="nf">add_gaussian_prior_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sigma_list</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a Gaussian priors on all of the model parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">          sigma_list (list): List of standard deviations of the Gaussian priors to apply.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">sigma_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">)</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Priors must be specified for all parameters if set by list.  If sigma is None, no prior will be applied.&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="kc">None</span></div>
        

<div class="viewcode-block" id="FisherForecast.generate_image"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.generate_image">[docs]</a>    <span class="k">def</span> <span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate and return an image for the parent visibility model evaluated</span>
<span class="sd">        at a given set of parameter values.  The user is responsible for setting</span>
<span class="sd">        the plot limits and shape intelligently.  Note that this uses FFTs and </span>
<span class="sd">        assumes that the resolution and field of view are sufficient to adequately</span>
<span class="sd">        resolve model image features.</span>

<span class="sd">        Args:</span>
<span class="sd">          p (list): List of parameter values.</span>
<span class="sd">          limits (float,list): Limits on the field of view in which to construct the image in uas.  Either a single float, in which case the limits are symmetric and set to [-limits,limits,-limits,limits], or a list of floats. Default: 100.</span>
<span class="sd">          shape (int,list): Dimensions of the image.  If an int, the dimensions are equal.  If a two-element list of ints, sets the dimensions to the two values. Default: 256.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          x (np.ndarray): x positions of the pixel centers in uas.</span>
<span class="sd">          y (np.ndarray): y positions of the pixel centers in uas.</span>
<span class="sd">          I (np.ndarray): Intensities at pixel centers in Jy/uas^2.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Fix image limits</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">limits</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="n">limits</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">limits</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="o">-</span><span class="n">limits</span><span class="p">,</span> <span class="n">limits</span><span class="p">]</span>

        <span class="c1"># Set shape</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">shape</span><span class="p">,</span> <span class="n">shape</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;limits:&quot;</span><span class="p">,</span><span class="n">limits</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;shape:&quot;</span><span class="p">,</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>            
        <span class="n">umax</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">uas2rad</span><span class="o">*</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">uas2rad</span><span class="o">*</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">limits</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max (u,v) = &quot;</span><span class="p">,(</span><span class="n">umax</span><span class="p">,</span><span class="n">vmax</span><span class="p">))</span>


        <span class="c1"># FIX</span>
        <span class="k">class</span> <span class="nc">obsempty</span> <span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        
        <span class="n">u</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="o">-</span><span class="n">umax</span><span class="p">:</span><span class="n">umax</span><span class="p">:(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="n">vmax</span><span class="p">:</span><span class="n">vmax</span><span class="p">:(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">]</span>
        <span class="n">obsgrid</span> <span class="o">=</span> <span class="n">obsempty</span><span class="p">()</span>
        <span class="n">obsgrid</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span>
        <span class="n">obsgrid</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obsgrid</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
        
        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">V</span><span class="p">)))</span>
        <span class="n">x1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">I</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])))</span>
        <span class="n">y1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">I</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])))</span>

        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x1d</span><span class="p">,</span><span class="n">y1d</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">uas2rad</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="n">uas2rad</span>

        <span class="n">obsgrid</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">obsgrid</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">I</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obsgrid</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;V00:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obsgrid</span><span class="p">,</span><span class="n">p</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sum I:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span> <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">I</span></div>

    
<div class="viewcode-block" id="FisherForecast.display_image"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.display_image">[docs]</a>    <span class="k">def</span> <span class="nf">display_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate and plot an image for the parent visibility model evaluated</span>
<span class="sd">        at a given set of parameter values.  The user is responsible for setting</span>
<span class="sd">        the plot limits and shape intelligently.  Note that this uses FFTs and </span>
<span class="sd">        assumes that the resolution and field of view are sufficient to adequately</span>
<span class="sd">        resolve model image features.</span>

<span class="sd">        Args:</span>
<span class="sd">          p (list): List of parameter values.</span>
<span class="sd">          limits (float,list): Limits on the field of view in which to construct the image in uas.  Either a single float, in which case the limits are symmetric and set to [-limits,limits,-limits,limits], or a list of floats. Default: 100.</span>
<span class="sd">          shape (int,list): Dimensions of the image.  If an int, the dimensions are equal.  If a two-element list of ints, sets the dimensions to the two values. Default: 256.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          fig (matplotlib.pyplot.figure): Figure handle</span>
<span class="sd">          axs (matplotlib.pyplot.axes): Axes handle</span>
<span class="sd">          cb (matplotlib.pyplot.colorbar): Colorbar handle</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">axs</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.8</span><span class="o">*</span><span class="mi">5</span><span class="o">/</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span>

        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_image</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

        <span class="n">Imax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Imax</span><span class="o">&gt;</span><span class="mf">1e-1</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">fu</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I~({\rm Jy}/\mu{\rm as}^2)$&#39;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">Imax</span><span class="o">&gt;</span><span class="mf">1e-4</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">fu</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I~({\rm mJy}/\mu{\rm as}^2)$&#39;</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="mf">1e3</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">Imax</span><span class="o">&gt;</span><span class="mf">1e-7</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">fu</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I~({\rm \mu Jy}/\mu{\rm as}^2)$&#39;</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="mf">1e6</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">Imax</span><span class="o">&gt;</span><span class="mf">1e-10</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">fu</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I~({\rm nJy}/\mu{\rm as}^2)$&#39;</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="mf">1e9</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">Imax</span><span class="o">&gt;</span><span class="mf">1e-13</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">fu</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I~({\rm pJy}/\mu{\rm as}^2)$&#39;</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="mf">1e12</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;afmhot&#39;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta{\rm RA}~(\mu{\rm as})$&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta{\rm Dec}~(\mu{\rm as})$&#39;</span><span class="p">)</span>

        <span class="n">cbax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.8</span><span class="o">*</span><span class="mi">5</span><span class="o">/</span><span class="mf">6.5</span><span class="o">+</span><span class="mf">0.05</span><span class="o">+</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="o">=</span><span class="n">cbax</span><span class="p">)</span>
        <span class="n">cbax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">fu</span><span class="p">,</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">(),</span><span class="n">axs</span><span class="p">,</span><span class="n">cbax</span></div>
        
        

<div class="viewcode-block" id="FisherForecast.check_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.check_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">check_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Numerically evaluates the gradients using the visibilities function and</span>
<span class="sd">        compares them to the gradients returned by the visibility_gradients</span>
<span class="sd">        function.  Numerical differentiation is 2nd-order, centered finite</span>
<span class="sd">        differences.  Results are output to standard out.  For best results,</span>
<span class="sd">        the user should pass some option for the step size h to use for numerical </span>
<span class="sd">        differentiation.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (Obsdata): An ehtim Obsdata object with a particular set of observation details (u,v positions, times, etc.) at which to check gradients..</span>
<span class="sd">          p (list): List of parameter values.</span>
<span class="sd">          h (float,list): List of small steps which define the finite differences.  If None, uses 1e-4*p.  If a float, uses h*p.  If a list, sets each step size separately.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">h</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mf">1e-4</span><span class="p">])</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="n">h</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="n">gradV_an</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibility_gradients</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
            <span class="n">gradV_fd</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">Vp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
                <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">Vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
                <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="n">gradV_fd</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">Vp</span><span class="o">-</span><span class="n">Vm</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">gradV_fd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradV_fd</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gradV_an_RR</span><span class="p">,</span> <span class="n">gradV_an_LL</span><span class="p">,</span> <span class="n">gradV_an_RL</span><span class="p">,</span> <span class="n">gradV_an_LR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibility_gradients</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
            <span class="n">gradV_an</span> <span class="o">=</span> <span class="n">gradV_an_RR</span> <span class="o">+</span> <span class="n">gradV_an_LL</span> <span class="o">+</span> <span class="n">gradV_an_RL</span> <span class="o">+</span> <span class="n">gradV_an_LR</span>
            <span class="n">gradV_fd</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">Vp_RR</span><span class="p">,</span> <span class="n">Vp_LL</span><span class="p">,</span> <span class="n">Vp_RL</span><span class="p">,</span> <span class="n">Vp_LR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
                <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">Vm_RR</span><span class="p">,</span> <span class="n">Vm_LL</span><span class="p">,</span> <span class="n">Vm_RL</span><span class="p">,</span> <span class="n">Vm_LR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
                <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="n">gradV_fd</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">Vp_RR</span><span class="o">-</span><span class="n">Vm_RR</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="p">((</span><span class="n">Vp_LL</span><span class="o">-</span><span class="n">Vm_LL</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="p">((</span><span class="n">Vp_RL</span><span class="o">-</span><span class="n">Vm_RL</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="p">((</span><span class="n">Vp_LR</span><span class="o">-</span><span class="n">Vm_LR</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
            <span class="n">gradV_fd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradV_fd</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">lbls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_labels</span><span class="p">()</span>
        <span class="n">err</span> <span class="o">=</span> <span class="p">(</span><span class="n">gradV_fd</span><span class="o">-</span><span class="n">gradV_an</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gradient Check Report:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Sample of errors by parameter&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%30s</span><span class="s2"> </span><span class="si">%15s</span><span class="s2"> </span><span class="si">%15s</span><span class="s2"> </span><span class="si">%15s</span><span class="s2"> </span><span class="si">%15s</span><span class="s2"> </span><span class="si">%15s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="s2">&quot;Param.&quot;</span><span class="p">,</span><span class="s2">&quot;u&quot;</span><span class="p">,</span><span class="s2">&quot;v&quot;</span><span class="p">,</span><span class="s2">&quot;anal. grad&quot;</span><span class="p">,</span><span class="s2">&quot;fd. grad&quot;</span><span class="p">,</span><span class="s2">&quot;err&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]),</span><span class="mi">10</span><span class="p">))</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%30s</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">lbls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="n">gradV_an</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">gradV_fd</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">err</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>

        <span class="n">mfe_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="n">mfe_i</span> <span class="o">=</span> <span class="n">mfe_arg</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span>
        <span class="n">mfe_j</span> <span class="o">=</span> <span class="n">mfe_arg</span><span class="o">//</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span>
        <span class="n">max_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Global Maximum error:&quot;</span><span class="p">,</span><span class="n">max_err</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%30s</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">lbls</span><span class="p">[</span><span class="n">mfe_i</span><span class="p">],</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">][</span><span class="n">mfe_j</span><span class="p">],</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">mfe_j</span><span class="p">],</span><span class="n">gradV_an</span><span class="p">[</span><span class="n">mfe_j</span><span class="p">][</span><span class="n">mfe_i</span><span class="p">],</span><span class="n">gradV_fd</span><span class="p">[</span><span class="n">mfe_j</span><span class="p">][</span><span class="n">mfe_i</span><span class="p">],</span><span class="n">err</span><span class="p">[</span><span class="n">mfe_j</span><span class="p">][</span><span class="n">mfe_i</span><span class="p">]))</span></div>
        

            
<div class="viewcode-block" id="FisherForecast.fisher_covar"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.fisher_covar">[docs]</a>    <span class="k">def</span> <span class="nf">fisher_covar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Fisher matrix M as defined in the accompanying documentation.</span>
<span class="sd">        Intelligently avoids recomputation if the observation and parameters are</span>
<span class="sd">        unchanged.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (Obsdata): An Obsdata object containing the observation particulars.</span>
<span class="sd">          p (list): List of model parameters at which to compute the Fisher matrix.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          M (np.ndarray): The Fisher matrix M.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get the fisher covariance </span>
        <span class="n">new_argument_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">new_argument_hash</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">covar</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="n">new_argument_hash</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
                <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">switch_polrep</span><span class="p">(</span><span class="s1">&#39;stokes&#39;</span><span class="p">)</span>
                <span class="n">gradV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibility_gradients</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">covar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">gradV</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">gradV</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">gradV</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">gradV</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">switch_polrep</span><span class="p">(</span><span class="s1">&#39;circ&#39;</span><span class="p">)</span>
                <span class="n">grad_RR</span><span class="p">,</span> <span class="n">grad_LL</span><span class="p">,</span> <span class="n">grad_RL</span><span class="p">,</span> <span class="n">grad_LR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibility_gradients</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">covar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">grad_RR</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">grad_RR</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rrsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">grad_RR</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">grad_RR</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rrsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">grad_LL</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">grad_LL</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;llsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">grad_LL</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">grad_LL</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;llsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">grad_RL</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">grad_RL</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rlsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">grad_RL</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">grad_RL</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rlsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">grad_LR</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">grad_LR</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lrsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">grad_LR</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">grad_LR</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lrsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FisherCovar covar before priors:&quot;</span><span class="p">)</span>
                <span class="n">_print_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">2.0</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># Why factor of 2?</span>
        
            <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FisherCovar covar after priors:&quot;</span><span class="p">)</span>
                <span class="n">_print_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FisherCovar priors:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dimensions:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

                
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">covar</span></div>

    
<div class="viewcode-block" id="FisherForecast.uniparameter_uncertainties"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.uniparameter_uncertainties">[docs]</a>    <span class="k">def</span> <span class="nf">uniparameter_uncertainties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ilist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the uncertainties on a subset of model parameters, fixing all</span>
<span class="sd">        others. Note that this is not a covariance; each uncertainty is for a </span>
<span class="sd">        single parameter, fixing all others.  This is probably not what is wanted</span>
<span class="sd">        for forecasting, see marginalized_uncertainties.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (Obsdata): An Obsdata object containing the observation particulars.</span>
<span class="sd">          p (list): List of parameter values at which to compute uncertainties.</span>
<span class="sd">          ilist (int,list) : Index or list of indicies for which to compute the uncertainties. If None will return a list of all uncertainties. Default: None.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Sigma (float,list): Parameter uncertainty or list of marginalized uncertainties of desired parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fisher_covar</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ilist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">ilist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">ilist</span><span class="p">][</span><span class="n">ilist</span><span class="p">]</span>
            <span class="n">Sig_uni</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">Sig_uni</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ilist</span> <span class="p">:</span>
                <span class="n">N</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">Sig_uni</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">Sig_uni</span></div>

    
<div class="viewcode-block" id="FisherForecast.marginalized_uncertainties"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.marginalized_uncertainties">[docs]</a>    <span class="k">def</span> <span class="nf">marginalized_uncertainties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ilist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the uncertainties on a subset of model parameters, marginalized</span>
<span class="sd">        over all others. Note that this is not the marginalized covariance; each</span>
<span class="sd">        uncertainty is for a single parameter, marginalizing out all others.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (Obsdata): An Obsdata object containing the observation particulars.</span>
<span class="sd">          p (list): List of parameter values at which to compute uncertainties.</span>
<span class="sd">          ilist (int,list) : Index or list of indicies for which to compute the marginalized uncertainties. If None will return a list of all marginalized uncertainties. Default: None.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Sigma (float,list): Marginalized parameter uncertainty or list of marginalized uncertainties of desired parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fisher_covar</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># M = np.zeros((self.size-1,self.size-1))</span>
        <span class="c1"># v = np.zeros(self.size-1)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">ilist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">ilist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">ilist</span>
            <span class="n">ilist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">ini</span> <span class="o">=</span> <span class="n">ilist</span><span class="p">[</span><span class="n">ilist</span><span class="o">!=</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># for j2,j in enumerate(ini) :</span>
            <span class="c1">#     for k2,k in enumerate(ini) :</span>
            <span class="c1">#         M[j2,k2] = C[j][k]</span>
            <span class="c1">#     v[j2] = C[i][j]</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">ini</span><span class="p">,:][:,</span><span class="n">ini</span><span class="p">]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">ini</span><span class="p">]</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># Minv = _invert_matrix(M)</span>
            <span class="c1"># mN = N - np.matmul(v,np.matmul(Minv,v))</span>
            <span class="c1"># print(&quot;Before mN:&quot;,mN)</span>
            <span class="n">v</span><span class="p">,</span><span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condition_vM</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">M</span><span class="p">)</span>
            <span class="n">Minv</span> <span class="o">=</span> <span class="n">_invert_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
            <span class="n">mN</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Minv</span><span class="p">,</span><span class="n">v</span><span class="p">)))</span>
            <span class="c1"># print(&quot;After mN:&quot;,mN)</span>
            <span class="n">Sig_marg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">mN</span><span class="p">)</span>

        <span class="k">else</span> <span class="p">:</span>
            <span class="n">Sig_marg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">))</span>
            <span class="n">iall</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">ini</span> <span class="o">=</span> <span class="n">iall</span><span class="p">[</span><span class="n">iall</span><span class="o">!=</span><span class="n">i</span><span class="p">]</span>
                <span class="c1"># for j2,j in enumerate(ini) :</span>
                <span class="c1">#     for k2,k in enumerate(ini) :</span>
                <span class="c1">#         M[j2,k2] = C[j][k]</span>
                <span class="c1">#     v[j2] = C[i][j]</span>
                <span class="n">M</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">ini</span><span class="p">,:][:,</span><span class="n">ini</span><span class="p">]</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">ini</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">N</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="c1"># Minv = _invert_matrix(M)</span>
                <span class="c1"># mN = N - np.matmul(v,np.matmul(Minv,v))</span>
                <span class="c1"># print(&quot;Before mN:&quot;,mN)</span>
                <span class="n">v</span><span class="p">,</span><span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condition_vM</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">M</span><span class="p">)</span>
                <span class="n">Minv</span> <span class="o">=</span> <span class="n">_invert_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
                <span class="n">mN</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Minv</span><span class="p">,</span><span class="n">v</span><span class="p">))</span>
                <span class="c1"># print(&quot;After mN:&quot;,mN)</span>
                <span class="n">Sig_marg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">mN</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">Sig_marg</span></div>


<div class="viewcode-block" id="FisherForecast.marginalized_covariance"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.marginalized_covariance">[docs]</a>    <span class="k">def</span> <span class="nf">marginalized_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ilist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the covariance for a subset of model parameters, marginalized</span>
<span class="sd">        over all parameters outside of the subset.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (Obsdata): An Obsdata object containing the observation particulars.</span>
<span class="sd">          p (list): List of parameter values at which to compute uncertainties.</span>
<span class="sd">          ilist (int,list) : Index or list of indicies for which to compute the marginalized uncertainties. If None will return a list of all marginalized uncertainties. Default: None.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          covar (np.ndarray): Marginalized covariance for desired parameter subset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fisher_covar</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ilist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="n">C</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginalized_uncertainties</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ilist</span><span class="o">=</span><span class="n">ilist</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">iall</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">isni</span> <span class="o">=</span> <span class="p">(</span><span class="n">iall</span><span class="o">!=</span><span class="n">ilist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ilist</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">:</span>
                <span class="n">isni</span> <span class="o">=</span> <span class="n">isni</span><span class="o">*</span><span class="p">(</span><span class="n">iall</span><span class="o">!=</span><span class="n">i</span><span class="p">)</span>
            <span class="n">ini</span> <span class="o">=</span> <span class="n">iall</span><span class="p">[</span><span class="n">isni</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">ilist</span><span class="p">,:][:,</span><span class="n">ilist</span><span class="p">]</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">ini</span><span class="p">,:][:,</span><span class="n">ilist</span><span class="p">]</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">ini</span><span class="p">,:][:,</span><span class="n">ini</span><span class="p">]</span>
            <span class="c1"># print(&quot;Before mN:&quot;,n - np.matmul(r.T,np.matmul(_invert_matrix(m),r)))</span>
            <span class="n">r</span><span class="p">,</span><span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condition_vM</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
            <span class="c1"># print(&quot;After mN:&quot;,n - np.matmul(r.T,np.matmul(_invert_matrix(m),r)))</span>
            <span class="c1"># print(&quot;Shapes:&quot;,n.shape,r.shape,m.shape)</span>
            <span class="k">return</span> <span class="n">n</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">_invert_matrix</span><span class="p">(</span><span class="n">m</span><span class="p">),</span><span class="n">r</span><span class="p">))</span></div>
            
    
<div class="viewcode-block" id="FisherForecast.uncertainties"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.uncertainties">[docs]</a>    <span class="k">def</span> <span class="nf">uncertainties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ilist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the uncertainties on a subset of model parameters, both fixing</span>
<span class="sd">        and marginalizing over all others. </span>

<span class="sd">        Args:</span>
<span class="sd">          obs (Obsdata): An Obsdata object containing the observation particulars.</span>
<span class="sd">          p (list): List of parameter values at which to compute uncertainties.</span>
<span class="sd">          ilist (int,list) : Index or list of indicies for which to compute the marginalized uncertainties. If None will return a list of all marginalized uncertainties. Default: None.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          SigmaF (float,list): Parameter uncertainty or list of marginalized uncertainties of desired parameters.</span>
<span class="sd">          SigmaM (float,list): Marginalized parameter uncertainty or list of marginalized uncertainties of desired parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fisher_covar</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fisher Matrix:&quot;</span><span class="p">)</span>
            <span class="n">_print_matrix</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">ilist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">ilist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">ilist</span>
            <span class="n">ilist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">ini</span> <span class="o">=</span> <span class="n">ilist</span><span class="p">[</span><span class="n">ilist</span><span class="o">!=</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># for j2,j in enumerate(ini) :</span>
            <span class="c1">#     for k2,k in enumerate(ini) :</span>
            <span class="c1">#         M[j2,k2] = C[j][k]</span>
            <span class="c1">#     v[j2] = C[i][j]</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">ini</span><span class="p">,:][:,</span><span class="n">ini</span><span class="p">]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">ini</span><span class="p">]</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">v</span><span class="p">,</span><span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condition_vM</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">M</span><span class="p">)</span>
            <span class="n">Minv</span> <span class="o">=</span> <span class="n">_invert_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
            <span class="n">mN</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Minv</span><span class="p">,</span><span class="n">v</span><span class="p">))</span>
            <span class="n">Sig_uni</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
            <span class="n">Sig_marg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">mN</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>            
            <span class="n">Sig_uni</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">Sig_marg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ilist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ilist</span> <span class="p">:</span>
                <span class="n">ini</span> <span class="o">=</span> <span class="n">ilist</span><span class="p">[</span><span class="n">ilist</span><span class="o">!=</span><span class="n">i</span><span class="p">]</span>
                <span class="c1"># for j2,j in enumerate(ini) :</span>
                <span class="c1">#     for k2,k in enumerate(ini) :</span>
                <span class="c1">#         M[j2,k2] = C[j][k]</span>
                <span class="c1">#     v[j2] = C[i][j]</span>
                <span class="n">M</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">ini</span><span class="p">,:][:,</span><span class="n">ini</span><span class="p">]</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">ini</span><span class="p">]</span>
                <span class="n">N</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">v</span><span class="p">,</span><span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condition_vM</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">M</span><span class="p">)</span>
                <span class="n">Minv</span> <span class="o">=</span> <span class="n">_invert_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
                <span class="n">mN</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Minv</span><span class="p">,</span><span class="n">v</span><span class="p">))</span>
                <span class="n">Sig_uni</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
                <span class="n">Sig_marg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">mN</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Submatrix (</span><span class="si">%i</span><span class="s2">):&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="n">_print_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Submatrix inverse (</span><span class="si">%i</span><span class="s2">):&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>                
                    <span class="n">_print_matrix</span><span class="p">(</span><span class="n">Minv</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Subvectors v1 (</span><span class="si">%i</span><span class="s2">):&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="n">_print_vector</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;N,mN (</span><span class="si">%i</span><span class="s2">):&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">N</span><span class="p">,</span><span class="n">mN</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">Sig_uni</span><span class="p">,</span><span class="n">Sig_marg</span></div>

    
<div class="viewcode-block" id="FisherForecast.joint_biparameter_chisq"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.joint_biparameter_chisq">[docs]</a>    <span class="k">def</span> <span class="nf">joint_biparameter_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;marginalized&#39;</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the ensemble-averaged 2nd-order contribution to the chi-square</span>
<span class="sd">        for two parameters after fixing or marginalizing over all others.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (Obsdata): An Obsdata object containing the observation particulars.</span>
<span class="sd">          p (list): List of parameter values at which to compute uncertainties.</span>
<span class="sd">          i1 (int): Index of first parameter.</span>
<span class="sd">          i2 (int): Index of second parameter.</span>
<span class="sd">          kind (str): Choice of what to do with other parameters. Choices are &#39;marginalized&#39;, &#39;fixed&#39;.  Default: &#39;marginalized&#39;.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          SigmaF (float,list): Parameter uncertainty or list of marginalized uncertainties of desired parameters.</span>
<span class="sd">          SigmaM (float,list): Marginalized parameter uncertainty or list of marginalized uncertainties of desired parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fisher_covar</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ilist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        
        <span class="n">ini12</span> <span class="o">=</span> <span class="n">ilist</span><span class="p">[(</span><span class="n">ilist</span><span class="o">!=</span><span class="n">i1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ilist</span><span class="o">!=</span><span class="n">i2</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">j2</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ini12</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">k2</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ini12</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">M</span><span class="p">[</span><span class="n">j2</span><span class="p">,</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
            <span class="n">v1</span><span class="p">[</span><span class="n">j2</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="n">v2</span><span class="p">[</span><span class="n">j2</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i2</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
        <span class="n">N1</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i1</span><span class="p">][</span><span class="n">i1</span><span class="p">]</span>
        <span class="n">N2</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i2</span><span class="p">][</span><span class="n">i2</span><span class="p">]</span>
        <span class="n">C12</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i1</span><span class="p">][</span><span class="n">i2</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">kind</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="k">elif</span> <span class="p">(</span><span class="n">kind</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;marginalized&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fisher Matrix:&quot;</span><span class="p">)</span>
                <span class="n">_print_matrix</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Submatrix (</span><span class="si">%i</span><span class="s2">,</span><span class="si">%i</span><span class="s2">):&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">))</span>
                <span class="n">_print_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Subvectors v1:&quot;</span><span class="p">)</span>
                <span class="n">_print_vector</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Subvectors v2:&quot;</span><span class="p">)</span>
                <span class="n">_print_vector</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>

            <span class="c1"># print(&quot;i1,i2:&quot;,i1,i2)</span>
            <span class="c1"># print(v1.shape,v2.shape)</span>
            <span class="c1"># print(v1)</span>
            <span class="c1"># print(v2)</span>
            <span class="n">vv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># print(vv.shape)</span>
            <span class="c1"># print(vv)</span>
            <span class="c1"># print(vv[:,0],v1)</span>
            <span class="c1"># print(vv[:,1],v2)</span>
            <span class="c1"># print(&quot;  =================&quot;)</span>
            <span class="n">vv</span><span class="p">,</span><span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condition_vM</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span><span class="n">M</span><span class="p">)</span>
            <span class="c1"># print(&quot;  =================&quot;)</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">vv</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">vv</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># print(v1.shape,v2.shape)</span>
            
            <span class="n">Minv</span> <span class="o">=</span> <span class="n">_invert_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
            <span class="n">N1</span> <span class="o">=</span> <span class="n">N1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Minv</span><span class="p">,</span><span class="n">v1</span><span class="p">))</span>
            <span class="n">N2</span> <span class="o">=</span> <span class="n">N2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">v2</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Minv</span><span class="p">,</span><span class="n">v2</span><span class="p">))</span>
            <span class="n">C12</span> <span class="o">=</span> <span class="n">C12</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Minv</span><span class="p">,</span><span class="n">v2</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">v2</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Minv</span><span class="p">,</span><span class="n">v1</span><span class="p">)))</span>

        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Received unexpected value for kind, </span><span class="si">%s</span><span class="s2">. Allowed values are &#39;fixed&#39; and &#39;marginalized&#39;.&quot;</span><span class="p">))</span>
        
                    
        <span class="c1"># Find range with eigenvectors/values</span>
        <span class="n">l1</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="n">N1</span><span class="o">+</span><span class="n">N2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">N1</span><span class="o">-</span><span class="n">N2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">C12</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">l2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="n">N1</span><span class="o">+</span><span class="n">N2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">N1</span><span class="o">-</span><span class="n">N2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">C12</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span> <span class="n">C12</span><span class="p">,</span> <span class="n">l1</span><span class="o">-</span><span class="n">N1</span> <span class="p">]</span> <span class="p">)</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span> <span class="n">e1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">e1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span> <span class="p">)</span>
        <span class="n">e1</span> <span class="o">=</span> <span class="n">e1</span><span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">e1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">e1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="n">e2</span><span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">e2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">e2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">l1</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">l2</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Something&#39;s wrong! Variances are nonpositive!&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">N1</span><span class="p">,</span><span class="n">N2</span><span class="p">,</span><span class="n">C12</span><span class="p">)</span>
            <span class="c1"># print(mN1,mN2,mC12)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">l1</span><span class="o">&gt;</span><span class="n">l2</span> <span class="p">):</span>
            <span class="n">Sig_maj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">l2</span><span class="p">)</span>
            <span class="n">Sig_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">l1</span><span class="p">)</span>
            <span class="n">e_maj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span>
            <span class="n">e_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">Sig_maj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">l1</span><span class="p">)</span>
            <span class="n">Sig_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">l2</span><span class="p">)</span>
            <span class="n">e_maj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
            <span class="n">e_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span>

        <span class="n">dp1</span> <span class="o">=</span> <span class="mf">4.5</span><span class="o">*</span><span class="p">(</span> <span class="n">Sig_maj</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_maj</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">Sig_min</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_min</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">)</span>
        <span class="n">dp2</span> <span class="o">=</span> <span class="mf">4.5</span><span class="o">*</span><span class="p">(</span> <span class="n">Sig_maj</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_maj</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">Sig_min</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_min</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>

        <span class="n">Npx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="mi">16</span><span class="o">*</span><span class="n">Sig_maj</span><span class="o">/</span><span class="n">Sig_min</span><span class="p">,</span><span class="mi">1024</span><span class="p">)))</span>
        <span class="n">p1</span><span class="p">,</span><span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">dp1</span><span class="p">,</span><span class="n">dp1</span><span class="p">,</span><span class="n">Npx</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">dp2</span><span class="p">,</span><span class="n">dp2</span><span class="p">,</span><span class="n">Npx</span><span class="p">))</span>
        <span class="n">csq</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">N1</span><span class="o">*</span><span class="n">p1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">C12</span><span class="o">*</span><span class="n">p1</span><span class="o">*</span><span class="n">p2</span> <span class="o">+</span> <span class="n">N2</span><span class="o">*</span><span class="n">p2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">csq</span></div>


<div class="viewcode-block" id="FisherForecast.plot_1d_forecast"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.plot_1d_forecast">[docs]</a>    <span class="k">def</span> <span class="nf">plot_1d_forecast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">i1</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;marginalized&#39;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">alphas</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the marginalized posterior for a single parameter for a given observation.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">          obs (list,Obsdata): An Obsdata object or list of Obsdata objects containing the observation particulars.</span>
<span class="sd">          p (list): List of parameter values at which to compute uncertainties.</span>
<span class="sd">          i1 (int): Index of parameter to be plotted.</span>
<span class="sd">          kind (str): Choice of what to do with other parameters. Choices are &#39;marginalized&#39;, &#39;fixed&#39;. Default: &#39;marginalized&#39;.</span>
<span class="sd">          labels (list,str): A list of labels for each Obsdata object. When fewer labels than observations are provided, the first set of observations are labeled. Default: None.</span>
<span class="sd">          fig (matplotlib.figure.Figure): Figure on which to place plot. If None, a new figure will be created. Default: None.</span>
<span class="sd">          axes (matplotlib.axes.Axes): Axes on which to place plot. If None, a new axes will be created. Default: None.</span>
<span class="sd">          colors (list,str): A color or list of colors for the plots. When fewer colors than observations are provided, they will be cycled through. If None, a default list will be used. Default: None.</span>
<span class="sd">          alphas (list,float): An alpha value or list of alpha values for the filled portion of the plots. Default: 0.25.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (matplotlib.figure.Figure, matplotlib.axes.Axes): Handles to the figure and axes objects in the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">obslist</span> <span class="o">=</span> <span class="n">obs</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">obslist</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obslist</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">obslist</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Label list must have the same size as the observation list.&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_color_list</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">colors</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="n">alphas</span><span class="p">]</span>
            

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obslist</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">kind</span><span class="o">==</span><span class="s1">&#39;marginalized&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">Sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginalized_uncertainties</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ilist</span><span class="o">=</span><span class="n">i1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">kind</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">Sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniparameter_uncertainties</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ilist</span><span class="o">=</span><span class="n">i1</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Received unexpected value for kind, </span><span class="si">%s</span><span class="s2">. Allowed values are &#39;fixed&#39; and &#39;marginalized&#39;.&quot;</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="n">Sigma</span><span class="p">,</span><span class="mi">5</span><span class="o">*</span><span class="n">Sigma</span><span class="p">,</span><span class="mi">256</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">Sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">Sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_labels</span><span class="p">()[</span><span class="n">i1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">==</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">())</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">(),</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span></div>


<div class="viewcode-block" id="FisherForecast.plot_2d_forecast"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.plot_2d_forecast">[docs]</a>    <span class="k">def</span> <span class="nf">plot_2d_forecast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;marginalized&#39;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cmaps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">alphas</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the joint marginalized posterior for a pair of parameters for a given observation.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">          obs (list,Obsdata): An Obsdata object or list of Obsdata objects containing the observation particulars.</span>
<span class="sd">          p (list): List of parameter values at which to compute uncertainties.</span>
<span class="sd">          i1 (int): Index of first parameter to be plotted.</span>
<span class="sd">          i2 (int): Index of second parameter to be plotted.</span>
<span class="sd">          kind (str): Choice of what to do with other parameters. Choices are &#39;marginalized&#39;, &#39;fixed&#39;. Default: &#39;marginalized&#39;.</span>
<span class="sd">          labels (list,str): A list of labels for each Obsdata object. When fewer labels than observations are provided, the first set of observations are labeled. Default: None.</span>
<span class="sd">          fig (matplotlib.figure.Figure): Figure on which to place plot. If None, a new figure will be created. Default: None.</span>
<span class="sd">          axes (matplotlib.axes.Axes): Axes on which to place plot. If None, a new axes will be created. Default: None.</span>
<span class="sd">          colors (list,str): A color or list of colors for the plots. When fewer colors than observations are provided, they will be cycled through. If None, a default list will be used. Default: None.</span>
<span class="sd">          cmaps (list,matplotlib.colors.Colormap): A colormap or list of colormaps for the plots. When fewer colormaps than observations are provided, they will be cycled through. If None, a default list will be used. Default: None.</span>
<span class="sd">          alphas (list,float): An alpha value or list of alpha values for the filled portion of the plots. Default: 0.75.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (matplotlib.figure.Figure, matplotlib.axes.Axes): Handles to the figure and axes objects in the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">obslist</span> <span class="o">=</span> <span class="n">obs</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">obslist</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obslist</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">obslist</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Label list must have the same size as the observation list.&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.75</span><span class="p">])</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_color_list</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">colors</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">cmaps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">cmaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_cmap_list</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cmaps</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">cmaps</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmaps</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="n">alphas</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obslist</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">d</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">csq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_biparameter_chisq</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">csq</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">cmaps</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">csq</span><span class="p">),</span><span class="n">colors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_labels</span><span class="p">()[</span><span class="n">i1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_labels</span><span class="p">()[</span><span class="n">i2</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">==</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">())</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">(),</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span></div>


<div class="viewcode-block" id="FisherForecast.plot_triangle_forecast"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.plot_triangle_forecast">[docs]</a>    <span class="k">def</span> <span class="nf">plot_triangle_forecast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ilist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;marginalized&#39;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cmaps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">alphas</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">axis_location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a triangle plot of joint posteriors for a selected list of parameter indexes.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">          obs (list,Obsdata): An Obsdata object or list of Obsdata objects containing the observation particulars.</span>
<span class="sd">          p (list): List of parameter values at which to compute uncertainties.</span>
<span class="sd">          ilist (list): List of indicies of parameters to include in triangle plot. If None, includes all parameters. Default: None.</span>
<span class="sd">          kind (str): Choice of what to do with other parameters. Choices are &#39;marginalized&#39;, &#39;fixed&#39;. Default: &#39;marginalized&#39;.</span>
<span class="sd">          labels (list,str): A list of labels for each Obsdata object. When fewer labels than observations are provided, the first set of observations are labeled. Default: None.</span>
<span class="sd">          colors (list,str): A color or list of colors for the plots. When fewer colors than observations are provided, they will be cycled through. If None, a default list will be used. Default: None.</span>
<span class="sd">          cmaps (list,matplotlib.colors.Colormap): A colormap or list of colormaps for the plots. When fewer colormaps than observations are provided, they will be cycled through. If None, a default list will be used. Default: None.</span>
<span class="sd">          alphas (list,float): An alpha value or list of alpha values for the filled portion of the plots. Default: 0.75.</span>
<span class="sd">          fig (matplotlib.figure.Figure): Figure on which to place plot. If None, a new figure will be created. Default: None.</span>
<span class="sd">          axes (matplotlib.axes.Axes): Axes on which to place plot. If None, a new axes will be created. Default: None.</span>
<span class="sd">          figsize (list): Figure size in inches.  If None, attempts a guess. Default: None.</span>
<span class="sd">          axis_location (list): Location parameters for triangle plot region. If None, attempts a guess. Default: None.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (matplotlib.figure.Figure, dict): Handles to the figure and dictionary of axes objects in the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">obslist</span> <span class="o">=</span> <span class="n">obs</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">obslist</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ilist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">ilist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obslist</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">obslist</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Label list must have the same size as the observation list.&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_color_list</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">colors</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">cmaps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">cmaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_cmap_list</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cmaps</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">cmaps</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmaps</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="n">alphas</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span><span class="o">*</span><span class="mf">2.5</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span><span class="o">*</span><span class="mf">2.5</span><span class="p">))</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scf</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">figsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">figsize</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">plg</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">axis_location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">lmarg</span> <span class="o">=</span> <span class="mf">0.625</span> <span class="c1"># Margin in inches</span>
            <span class="n">rmarg</span> <span class="o">=</span> <span class="mf">0.625</span> <span class="c1"># Margin in inches</span>
            <span class="n">tmarg</span> <span class="o">=</span> <span class="mf">0.625</span> <span class="c1"># Margin in inches</span>
            <span class="n">bmarg</span> <span class="o">=</span> <span class="mf">0.625</span> <span class="c1"># Margin in inches</span>
            <span class="n">ax0</span> <span class="o">=</span> <span class="n">lmarg</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ay0</span> <span class="o">=</span> <span class="n">bmarg</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">axw</span> <span class="o">=</span> <span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">lmarg</span><span class="o">-</span><span class="n">rmarg</span><span class="p">)</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ayw</span> <span class="o">=</span> <span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">tmarg</span><span class="o">-</span><span class="n">bmarg</span><span class="p">)</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">axis_location</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ay0</span><span class="p">,</span> <span class="n">axw</span><span class="p">,</span> <span class="n">ayw</span><span class="p">]</span>

        <span class="c1"># Number of rows/columns</span>
        <span class="n">nrow</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span>

        <span class="c1"># Make axes dictionary if it doesn&#39;t exist already</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="c1"># Get window size details</span>
            <span class="n">gutter_size</span> <span class="o">=</span> <span class="mf">0.0625</span> <span class="c1"># Gutter in inches</span>
            <span class="n">x_gutter</span> <span class="o">=</span> <span class="n">gutter_size</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_gutter</span> <span class="o">=</span> <span class="n">gutter_size</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x_window_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">axis_location</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">nrow</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x_gutter</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span>
            <span class="n">y_window_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">axis_location</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">nrow</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">y_gutter</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span>
            
            <span class="n">axes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                    <span class="c1"># Find axis location with various gutters, etc.</span>
                    <span class="n">x_window_start</span> <span class="o">=</span> <span class="n">axis_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">x_gutter</span><span class="o">+</span><span class="n">x_window_size</span><span class="p">)</span>
                    <span class="n">y_window_start</span> <span class="o">=</span> <span class="n">axis_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">axis_location</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_window_size</span> <span class="o">-</span> <span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">y_gutter</span><span class="o">+</span><span class="n">y_window_size</span><span class="p">)</span>
                    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="n">x_window_start</span><span class="p">,</span> <span class="n">y_window_start</span><span class="p">,</span> <span class="n">x_window_size</span><span class="p">,</span> <span class="n">y_window_size</span><span class="p">])</span>

        <span class="c1"># Run over panels and plot</span>
        <span class="n">xlim_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obslist</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">kind</span><span class="o">==</span><span class="s1">&#39;marginalized&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">Sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginalized_uncertainties</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">kind</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">Sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniparameter_uncertainties</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Received unexpected value for kind, </span><span class="si">%s</span><span class="s2">. Allowed values are &#39;fixed&#39; and &#39;marginalized&#39;.&quot;</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">jj</span> <span class="o">=</span> <span class="n">ilist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">xtmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.5</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="mf">3.5</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="mi">256</span><span class="p">)</span>
                <span class="n">ytmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xtmp</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xtmp</span><span class="p">,</span><span class="n">ytmp</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xtmp</span><span class="p">,</span><span class="n">ytmp</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">xlim_dict</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">3.5</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="mf">3.5</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="mf">3.5</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">&gt;</span><span class="n">xlim_dict</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
                        <span class="n">xlim_dict</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">3.5</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="mf">3.5</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>                    

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="p">:</span>

                    <span class="c1"># ii = ilist[ni-i]</span>
                    <span class="n">ii</span> <span class="o">=</span> <span class="n">ilist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">jj</span> <span class="o">=</span> <span class="n">ilist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

                    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>

                    <span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">csq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_biparameter_chisq</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">csq</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">cmaps</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">csq</span><span class="p">),</span><span class="n">colors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>

                    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim_dict</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">xlim_dict</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

                    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>

                    <span class="c1"># plt.text(0.05,0.05,&#39;%i,%i / %i,%i&#39;%(i,j,ii,jj),transform=plt.gca().transAxes)</span>


        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim_dict</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>


        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nrow</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_labels</span><span class="p">()[</span><span class="n">ilist</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">nrow</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_labels</span><span class="p">()[</span><span class="n">ilist</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>


        <span class="c1"># Make axis for labels</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">==</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">())</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.01</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obslist</span><span class="p">))</span> <span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">bottom</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>


        <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">(),</span><span class="n">axes</span></div>

    
    <span class="k">def</span> <span class="nf">_condition_vM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">M</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A helper function that conditions the vector and matrix associated </span>
<span class="sd">        with marginalization.  This conditioning does not change v.M^{-1}.v,</span>
<span class="sd">        but does ensure that all quantities in the matrix multiplication</span>
<span class="sd">        and matrix inversion are of similar size.  It cannot address numerical</span>
<span class="sd">        instability caused by strongly correlated or nearly degenerate M.</span>
<span class="sd">        </span>
<span class="sd">        The components of the marginalization process assume a structure for</span>
<span class="sd">        the covariance that looks like:</span>

<span class="sd">                 ( N v.T )</span>
<span class="sd">                 ( v  M  )</span>

<span class="sd">        So, if N is an nxn array and M is an mxm array, v should be an mxn array.</span>

<span class="sd">        The conditioning procedure is equivalent to normalizing the parameters</span>
<span class="sd">        that are being marginalized by the square roots of their variances.</span>

<span class="sd">        Args:</span>
<span class="sd">          v (nd.array): Vector or matrix associated with the correlations between the parameters to be marginalized over and those to be retained.</span>
<span class="sd">          M (nd.array): Covariance of the marginalized parameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (nd.array,nd.array): Conditioned v and M. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Conditions v and M to improve inversion and double-dot product performance</span>
        <span class="n">il</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">il</span><span class="p">,</span><span class="n">il</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">il</span> <span class="p">:</span>
            <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">*</span><span class="n">dd</span>
            <span class="n">M</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">M</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">dd</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">dd</span><span class="o">*</span><span class="n">v</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
                <span class="n">v</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">dd</span>

        <span class="k">return</span> <span class="n">v</span><span class="p">,</span><span class="n">M</span>

    <span class="k">def</span> <span class="nf">_choose_from_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A helper function to cyclicly select from a list.</span>

<span class="sd">        Args:</span>
<span class="sd">          v (list): A list.</span>
<span class="sd">          i (int): An integer index.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Element of v at index i%len(v).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span></div>

    
<div class="viewcode-block" id="FF_complex_gains_single_epoch"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_complex_gains_single_epoch">[docs]</a><span class="k">class</span> <span class="nc">FF_complex_gains_single_epoch</span><span class="p">(</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FisherForecast with complex gain reconstruction assuming a single epoch.</span>
<span class="sd">    This is a helper class, and probably not the FisherForecast object that</span>
<span class="sd">    should be used to study the impact of gains.  See FF_complex_gains.</span>

<span class="sd">    Args:</span>
<span class="sd">      ff (FisherForecast): A FisherForecast object to which we wish to add gains.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      ff (FisherForecast): The FisherForecast object before gain reconstruction.</span>
<span class="sd">      plbls (list): List of parameter labels (str) including gains parameter names.</span>
<span class="sd">      gain_amplitude_priors (list): list of standard deviations of the log-normal priors on the gain amplitudes. Default: 10.</span>
<span class="sd">      gain_phase_priors (list): list of standard deviations on the normal priors on the gain phases. Default: 100.</span>
<span class="sd">      gain_ratio_amplitude_priors (list): For polarized gains, list of the log-normal priors on the gain amplitude ratios.  Default: 1e-10.</span>
<span class="sd">      gain_ratio_phase_priors (list): For polarized gains, list of the normal priors on the gain phase differences.  Default: 1e-10.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ff</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ff</span> <span class="o">=</span> <span class="n">ff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">stokes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scans</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plbls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">parameter_labels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">prior_sigma_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_amplitude_priors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_phase_priors</span> <span class="o">=</span> <span class="p">{}</span>
        
<div class="viewcode-block" id="FF_complex_gains_single_epoch.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_complex_gains_single_epoch.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Complex visibilities associated with the underlying FisherForecast object</span>
<span class="sd">        evaluated at the data points in the given Obsdata object for the model with</span>
<span class="sd">        the given parameter values.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (Obsdata): An ehtim Obsdata object with a particular set of observation details (u,v positions, times, etc.)</span>
<span class="sd">          p (np.array): list of parameters for the model at which visiblities are desired.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          V (np.array): list of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="FF_complex_gains_single_epoch.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_complex_gains_single_epoch.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gradients of the complex visibilities associated with the underlying </span>
<span class="sd">        FisherForecast object with respect to the model pararmeters evaluated at </span>
<span class="sd">        the data points in the given Obsdata object for the model with the given </span>
<span class="sd">        parameter values, including gradients with respect to the gain amplitudes,</span>
<span class="sd">        phases, and if this is a polarized model, R/L gain amplitude ratios and </span>
<span class="sd">        phase differences.  </span>

<span class="sd">        Args:</span>
<span class="sd">          obs (Obsdata): An ehtim Obsdata object with a particular set of observation details (u,v positions, times, etc.)</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          gradV (np.ndarray): list of complex visibility gradients computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Generate the gain epochs and update the size</span>
        <span class="n">station_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">],</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">])))</span>
        <span class="n">nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">station_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plbls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">parameter_labels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span> <span class="o">==</span> <span class="p">[])</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">):</span>

            <span class="n">V_pg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">gradV_pg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">visibility_gradients</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c1"># Start with model parameters</span>
            <span class="n">gradV</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gradV_pg</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

            <span class="c1"># Now add gains</span>
            <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">station_list</span> <span class="p">:</span>
                <span class="n">dVda</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">V_pg</span>
                <span class="n">dVdp</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">V_pg</span>

                <span class="c1"># G</span>
                <span class="n">inget1</span> <span class="o">=</span> <span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">station</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">inget1</span><span class="p">))</span> <span class="p">:</span>
                    <span class="n">dVda</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span> <span class="o">=</span> <span class="n">V_pg</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span>
                    <span class="n">dVdp</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">V_pg</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span>

                <span class="c1"># G*</span>
                <span class="n">inget2</span> <span class="o">=</span> <span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">station</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">inget2</span><span class="p">))</span> <span class="p">:</span>
                    <span class="n">dVda</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span> <span class="o">=</span> <span class="n">V_pg</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span>
                    <span class="n">dVdp</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">V_pg</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span>

                <span class="c1"># Check if any cases</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">inget1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">inget2</span><span class="p">))</span> <span class="p">:</span>

                    <span class="n">gradV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dVda</span><span class="p">)</span>
                    <span class="n">gradV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dVdp</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span><span class="mi">2</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\ln(|G|_{</span><span class="si">%s</span><span class="s1">})$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">station</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;${\rm arg}(G_{</span><span class="si">%s</span><span class="s1">})$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">station</span><span class="p">))</span>

                    <span class="k">if</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                        
                        <span class="c1"># Set amplitude priors</span>
                        <span class="k">if</span> <span class="p">(</span> <span class="n">station</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="p">[</span><span class="n">station</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="p">(</span> <span class="s1">&#39;All&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="p">[</span><span class="s1">&#39;All&#39;</span><span class="p">])</span>
                        <span class="k">else</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span> <span class="c1"># Big amplitude</span>

                        <span class="c1"># Set phase priors</span>
                        <span class="k">if</span> <span class="p">(</span> <span class="n">station</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span><span class="p">[</span><span class="n">station</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="p">(</span> <span class="s1">&#39;All&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span><span class="p">[</span><span class="s1">&#39;All&#39;</span><span class="p">])</span>
                        <span class="k">else</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">100.0</span><span class="p">)</span> <span class="c1"># Big phase</span>

                    <span class="k">else</span> <span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span> <span class="c1"># Big amplitude</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">100.0</span><span class="p">)</span> <span class="c1"># Big phase</span>

            <span class="n">gradV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradV</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">gradV</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;SEG gradV: </span><span class="si">%10.3g</span><span class="s2"> </span><span class="si">%10.3g</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gradV</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">+</span> <span class="s2">&quot; </span><span class="si">%8.3g</span><span class="s2"> + </span><span class="si">%8.3g</span><span class="s2">i&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">gradV</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">gradV</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">gradV</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">RR_pg</span><span class="p">,</span> <span class="n">LL_pg</span><span class="p">,</span> <span class="n">RL_pg</span><span class="p">,</span> <span class="n">LR_pg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">gradRR_pg</span><span class="p">,</span> <span class="n">gradLL_pg</span><span class="p">,</span> <span class="n">gradRL_pg</span><span class="p">,</span> <span class="n">gradLR_pg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">visibility_gradients</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c1"># start with the current list of model parameters</span>
            <span class="n">gradRR</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gradRR_pg</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">gradLL</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gradLL_pg</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">gradRL</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gradRL_pg</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">gradLR</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gradLR_pg</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

            <span class="c1"># add gains</span>
            <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">station_list</span> <span class="p">:</span>
                
                <span class="n">dRRda</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">RR_pg</span>
                <span class="n">dRRdp</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">RR_pg</span>
                <span class="n">dRRdr</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">RR_pg</span>
                <span class="n">dRRdt</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">RR_pg</span>

                <span class="n">dLLda</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">LL_pg</span>
                <span class="n">dLLdp</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">LL_pg</span>
                <span class="n">dLLdr</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">LL_pg</span>
                <span class="n">dLLdt</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">LL_pg</span>

                <span class="n">dRLda</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">RL_pg</span>
                <span class="n">dRLdp</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">RL_pg</span>
                <span class="n">dRLdr</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">RL_pg</span>
                <span class="n">dRLdt</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">RL_pg</span>

                <span class="n">dLRda</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">LR_pg</span>
                <span class="n">dLRdp</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">LR_pg</span>
                <span class="n">dLRdr</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">LR_pg</span>
                <span class="n">dLRdt</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">LR_pg</span>

                <span class="c1"># G</span>
                <span class="n">inget1</span> <span class="o">=</span> <span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">station</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">inget1</span><span class="p">))</span> <span class="p">:</span>

                    <span class="n">dRRda</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span> <span class="o">=</span> <span class="n">RR_pg</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span>
                    <span class="n">dRRdp</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">RR_pg</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span>
                    <span class="n">dRRdr</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">RR_pg</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span>
                    <span class="n">dRRdt</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="n">j</span> <span class="o">*</span> <span class="n">RR_pg</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span>

                    <span class="n">dLLda</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span> <span class="o">=</span> <span class="n">LL_pg</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span>
                    <span class="n">dLLdp</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">LL_pg</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span>
                    <span class="n">dLLdr</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">LL_pg</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span>
                    <span class="n">dLLdt</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="n">j</span> <span class="o">*</span> <span class="n">LL_pg</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span>

                    <span class="n">dRLda</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span> <span class="o">=</span> <span class="n">RL_pg</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span>
                    <span class="n">dRLdp</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">RL_pg</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span>
                    <span class="n">dRLdr</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">RL_pg</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span>
                    <span class="n">dRLdt</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="n">j</span> <span class="o">*</span> <span class="n">RL_pg</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span>

                    <span class="n">dLRda</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span> <span class="o">=</span> <span class="n">LR_pg</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span>
                    <span class="n">dLRdp</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">LR_pg</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span>
                    <span class="n">dLRdr</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">LR_pg</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span>
                    <span class="n">dLRdt</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="n">j</span> <span class="o">*</span> <span class="n">LR_pg</span><span class="p">[</span><span class="n">inget1</span><span class="p">]</span>

                <span class="c1"># G*</span>
                <span class="n">inget2</span> <span class="o">=</span> <span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">station</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">inget2</span><span class="p">))</span> <span class="p">:</span>

                    <span class="n">dRRda</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span> <span class="o">=</span> <span class="n">RR_pg</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span>
                    <span class="n">dRRdp</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">RR_pg</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span>
                    <span class="n">dRRdr</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">RR_pg</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span>
                    <span class="n">dRRdt</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="n">j</span> <span class="o">*</span> <span class="n">RR_pg</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span>

                    <span class="n">dLLda</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span> <span class="o">=</span> <span class="n">LL_pg</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span>
                    <span class="n">dLLdp</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">LL_pg</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span>
                    <span class="n">dLLdr</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">LL_pg</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span>
                    <span class="n">dLLdt</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="n">j</span> <span class="o">*</span> <span class="n">LL_pg</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span>

                    <span class="n">dRLda</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span> <span class="o">=</span> <span class="n">RL_pg</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span>
                    <span class="n">dRLdp</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">RL_pg</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span>
                    <span class="n">dRLdr</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">RL_pg</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span>
                    <span class="n">dRLdt</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="n">j</span> <span class="o">*</span> <span class="n">RL_pg</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span>

                    <span class="n">dLRda</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span> <span class="o">=</span> <span class="n">LR_pg</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span>
                    <span class="n">dLRdp</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">LR_pg</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span>
                    <span class="n">dLRdr</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">LR_pg</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span>
                    <span class="n">dLRdt</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="n">j</span> <span class="o">*</span> <span class="n">LR_pg</span><span class="p">[</span><span class="n">inget2</span><span class="p">]</span>

                <span class="c1"># check if any cases</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">inget1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">inget2</span><span class="p">))</span> <span class="p">:</span>

                    <span class="n">gradRR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dRRda</span><span class="p">)</span>
                    <span class="n">gradRR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dRRdp</span><span class="p">)</span>
                    <span class="n">gradRR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dRRdr</span><span class="p">)</span>
                    <span class="n">gradRR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dRRdt</span><span class="p">)</span>

                    <span class="n">gradLL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dLLda</span><span class="p">)</span>
                    <span class="n">gradLL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dLLdp</span><span class="p">)</span>
                    <span class="n">gradLL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dLLdr</span><span class="p">)</span>
                    <span class="n">gradLL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dLLdt</span><span class="p">)</span>

                    <span class="n">gradRL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dRLda</span><span class="p">)</span>
                    <span class="n">gradRL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dRLdp</span><span class="p">)</span>
                    <span class="n">gradRL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dRLdr</span><span class="p">)</span>
                    <span class="n">gradRL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dRLdt</span><span class="p">)</span>

                    <span class="n">gradLR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dLRda</span><span class="p">)</span>
                    <span class="n">gradLR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dLRdp</span><span class="p">)</span>
                    <span class="n">gradLR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dLRdr</span><span class="p">)</span>
                    <span class="n">gradLR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dLRdt</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="mi">4</span>

                    <span class="c1"># gain geometric mean labels</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\ln(|G|_{</span><span class="si">%s</span><span class="s1">})$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">station</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;${\rm arg}(G_{</span><span class="si">%s</span><span class="s1">})$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">station</span><span class="p">))</span>

                    <span class="c1"># gain ratio labels</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\ln(|R|_{</span><span class="si">%s</span><span class="s1">})$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">station</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;${\rm arg}(R_{</span><span class="si">%s</span><span class="s1">})$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">station</span><span class="p">))</span>

                    <span class="c1"># complex gain priors</span>
                    <span class="k">if</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                        
                        <span class="c1"># Set amplitude priors</span>
                        <span class="k">if</span> <span class="p">(</span> <span class="n">station</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="p">[</span><span class="n">station</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="p">(</span> <span class="s1">&#39;All&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="p">[</span><span class="s1">&#39;All&#39;</span><span class="p">])</span>
                        <span class="k">else</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span> <span class="c1"># Big amplitude</span>

                        <span class="c1"># Set phase priors</span>
                        <span class="k">if</span> <span class="p">(</span> <span class="n">station</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span><span class="p">[</span><span class="n">station</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="p">(</span> <span class="s1">&#39;All&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span><span class="p">[</span><span class="s1">&#39;All&#39;</span><span class="p">])</span>
                        <span class="k">else</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">100.0</span><span class="p">)</span> <span class="c1"># Big phase</span>

                    <span class="k">else</span> <span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span> <span class="c1"># Big amplitude</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">100.0</span><span class="p">)</span> <span class="c1"># Big phase</span>

                    <span class="c1"># complex gain ratio priors</span>
                    <span class="k">if</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_amplitude_priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_phase_priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>

                        <span class="c1"># Set gain ratio amplitude priors</span>
                        <span class="k">if</span> <span class="p">(</span> <span class="n">station</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_amplitude_priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_amplitude_priors</span><span class="p">[</span><span class="n">station</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="p">(</span> <span class="s1">&#39;All&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_amplitude_priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_amplitude_priors</span><span class="p">[</span><span class="s1">&#39;All&#39;</span><span class="p">])</span>
                        <span class="k">else</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1e-10</span><span class="p">)</span> <span class="c1"># small amplitude</span>

                        <span class="c1"># Set gain ratio phase priors</span>
                        <span class="k">if</span> <span class="p">(</span> <span class="n">station</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_phase_priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_phase_priors</span><span class="p">[</span><span class="n">station</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="p">(</span> <span class="s1">&#39;All&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_phase_priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_phase_priors</span><span class="p">[</span><span class="s1">&#39;All&#39;</span><span class="p">])</span>
                        <span class="k">else</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1e-10</span><span class="p">)</span> <span class="c1"># small phase</span>

                    <span class="k">else</span> <span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1e-10</span><span class="p">)</span> <span class="c1"># small amplitude</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1e-10</span><span class="p">)</span> <span class="c1"># small phase</span>

            <span class="n">gradRR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradRR</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">gradLL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradLL</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">gradRL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradRL</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">gradLR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradLR</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">gradRR</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;SEG gradRR: </span><span class="si">%10.3g</span><span class="s2"> </span><span class="si">%10.3g</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gradRR</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">+</span> <span class="s2">&quot; </span><span class="si">%8.3g</span><span class="s2"> + </span><span class="si">%8.3g</span><span class="s2">i&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">gradRR</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">gradRR</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">gradLL</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;SEG gradLL: </span><span class="si">%10.3g</span><span class="s2"> </span><span class="si">%10.3g</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gradLL</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">+</span> <span class="s2">&quot; </span><span class="si">%8.3g</span><span class="s2"> + </span><span class="si">%8.3g</span><span class="s2">i&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">gradLL</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">gradLL</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">gradRL</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;SEG gradRL: </span><span class="si">%10.3g</span><span class="s2"> </span><span class="si">%10.3g</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gradRL</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">+</span> <span class="s2">&quot; </span><span class="si">%8.3g</span><span class="s2"> + </span><span class="si">%8.3g</span><span class="s2">i&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">gradRL</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">gradRL</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">gradLR</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;SEG gradLR: </span><span class="si">%10.3g</span><span class="s2"> </span><span class="si">%10.3g</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gradLR</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">+</span> <span class="s2">&quot; </span><span class="si">%8.3g</span><span class="s2"> + </span><span class="si">%8.3g</span><span class="s2">i&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">gradLR</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">gradLR</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>


            <span class="c1"># print(&#39;Prior sigma list:&#39;,self.prior_sigma_list)</span>

            <span class="k">return</span> <span class="n">gradRR</span><span class="p">,</span> <span class="n">gradLL</span><span class="p">,</span> <span class="n">gradRL</span><span class="p">,</span> <span class="n">gradLR</span></div>

<div class="viewcode-block" id="FF_complex_gains_single_epoch.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_complex_gains_single_epoch.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameter labels to be used in plotting, including those associated</span>
<span class="sd">        with the gains.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          plabels (list): list of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plbls</span></div>

<div class="viewcode-block" id="FF_complex_gains_single_epoch.set_gain_amplitude_prior"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_complex_gains_single_epoch.set_gain_amplitude_prior">[docs]</a>    <span class="k">def</span> <span class="nf">set_gain_amplitude_prior</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">station</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the log-normal priors on the gain amplitudes, either for a</span>
<span class="sd">        specified station or for all stations.</span>

<span class="sd">        Args:</span>
<span class="sd">          sigma (float): Standard deviation of the log-amplitude.</span>
<span class="sd">          station (str,list): Station code of the station(s) for which the prior is to be set. If None, will set the prior on all stations. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span><span class="mf">10.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">station</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;All&#39;</span><span class="p">:</span><span class="n">sigma</span><span class="p">}</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">station</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">station</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FF_complex_gains_single_epoch.set_gain_phase_prior"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_complex_gains_single_epoch.set_gain_phase_prior">[docs]</a>    <span class="k">def</span> <span class="nf">set_gain_phase_prior</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">station</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the normal priors on the gain phases, either for a specified </span>
<span class="sd">        station or for all stations. Usually, this should be the default</span>
<span class="sd">        (uniformative).  </span>

<span class="sd">        Args:</span>
<span class="sd">          sigma (float): Standard deviation of the phase.</span>
<span class="sd">          station (str,list): Station code of the station(s) for which the prior is to be set. If None, will set the prior on all stations. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span><span class="mf">100.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">station</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;All&#39;</span><span class="p">:</span><span class="n">sigma</span><span class="p">}</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">station</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">station</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FF_complex_gains_single_epoch.set_gain_ratio_amplitude_prior"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_complex_gains_single_epoch.set_gain_ratio_amplitude_prior">[docs]</a>    <span class="k">def</span> <span class="nf">set_gain_ratio_amplitude_prior</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">station</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the log-normal priors on the R/L gain amplitude ratios, either </span>
<span class="sd">        for a specified station or for all stations. Only relevant for</span>
<span class="sd">        polarized models. Default: 1e-10 for all stations.</span>

<span class="sd">        Args:</span>
<span class="sd">          sigma (float): Standard deviation of the log-amplitude ratio.</span>
<span class="sd">          station (str,list): Station code of the station(s) for which the prior is to be set. If None, will set the prior on all stations. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span><span class="mf">100.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">station</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_amplitude_priors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;All&#39;</span><span class="p">:</span><span class="n">sigma</span><span class="p">}</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_amplitude_priors</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FF_complex_gains_single_epoch.set_gain_ratio_phase_prior"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_complex_gains_single_epoch.set_gain_ratio_phase_prior">[docs]</a>    <span class="k">def</span> <span class="nf">set_gain_ratio_phase_prior</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">station</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the normal priors on the R/L gain phase differences, either </span>
<span class="sd">        for a specified station or for all stations. Only relevant for</span>
<span class="sd">        polarized models. Default: 1e-10 for all stations.</span>

<span class="sd">        Args:</span>
<span class="sd">          sigma (float): Standard deviation of the phase.</span>
<span class="sd">          station (str,list): Station code of the station(s) for which the prior is to be set. If None, will set the prior on all stations. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span><span class="mf">100.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">station</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_phase_priors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;All&#39;</span><span class="p">:</span><span class="n">sigma</span><span class="p">}</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_phase_priors</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="kc">None</span></div></div>
        

<div class="viewcode-block" id="FF_complex_gains"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_complex_gains">[docs]</a><span class="k">class</span> <span class="nc">FF_complex_gains</span><span class="p">(</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FisherForecast with complex gain reconstruction with multiple epochs.</span>
<span class="sd">    This is usually the FisherForecast object that should be used to investigate</span>
<span class="sd">    the impact of uncertain station gains.</span>

<span class="sd">    Args:</span>
<span class="sd">      ff (FisherForecast): A FisherForecast object to which we wish to add gains.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      ff (FisherForecast): The FisherForecast object before gain reconstruction.</span>
<span class="sd">      gain_epochs (np.ndarray): 2D array containing the start and end times for each gain solution epoch.</span>
<span class="sd">      gain_amplitude_priors (list): list of standard deviations of the log-normal priors on the gain amplitudes. Default: 10.</span>
<span class="sd">      gain_phase_priors (list): list of standard deviations on the normal priors on the gain phases. Default: 100.</span>
<span class="sd">      gain_ratio_amplitude_priors (list): For polarized gains, list of the log-normal priors on the gain amplitude ratios.  Default: 1e-10.</span>
<span class="sd">      gain_ratio_phase_priors (list): For polarized gains, list of the normal priors on the gain phase differences.  Default: 1e-10.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ff</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ff</span> <span class="o">=</span> <span class="n">ff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">stokes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scans</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gain_epochs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">prior_sigma_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_amplitude_priors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span> <span class="o">=</span> <span class="n">FF_complex_gains_single_epoch</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        
<div class="viewcode-block" id="FF_complex_gains.set_gain_epochs"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_complex_gains.set_gain_epochs">[docs]</a>    <span class="k">def</span> <span class="nf">set_gain_epochs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">scans</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">gain_epochs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the gain solution intervals (gain epochs) to be used. If neither</span>
<span class="sd">        scans nor gain_epochs selected, will solve for gains on each unique</span>
<span class="sd">        timestamp in the data.</span>

<span class="sd">        Args:</span>
<span class="sd">          scans (bool): If True, solves for independent gains by scan. Overrides explicit specification of gain solution intervals. Default: False.</span>
<span class="sd">          gain_epochs (nd.array): 2D array containing the start and end times for each gain solution epoch. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scans</span> <span class="o">=</span> <span class="n">scans</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gain_epochs</span> <span class="o">=</span> <span class="n">gain_epochs</span></div>
        
    <span class="k">def</span> <span class="nf">generate_gain_epochs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="o">==</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">obs</span><span class="o">.</span><span class="n">add_scans</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_epochs</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">scans</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_epochs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">tu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">tu</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">tu</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dt</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="o">+</span><span class="p">[</span><span class="n">dt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_epochs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">tu</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_epochs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tu</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_epochs</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    
<div class="viewcode-block" id="FF_complex_gains.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_complex_gains.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Complex visibilities associated with the underlying FisherForecast object</span>
<span class="sd">        evaluated at the data points in the given Obsdata object for the model with</span>
<span class="sd">        the given parameter values.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (Obsdata): An ehtim Obsdata object with a particular set of observation details (u,v positions, times, etc.)</span>
<span class="sd">          p (np.array): list of parameters for the model at which visiblities are desired.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          V (np.array): list of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="FF_complex_gains.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_complex_gains.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gradients of the complex visibilities associated with the underlying </span>
<span class="sd">        FisherForecast object with respect to the model pararmeters evaluated at </span>
<span class="sd">        the data points in the given Obsdata object for the model with the given </span>
<span class="sd">        parameter values.  </span>

<span class="sd">        Args:</span>
<span class="sd">          obs (Obsdata): An ehtim Obsdata object with a particular set of observation details (u,v positions, times, etc.)</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          gradV (np.ndarray): list of complex visibility gradients computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">visibility_gradients</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="FF_complex_gains.fisher_covar"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_complex_gains.fisher_covar">[docs]</a>    <span class="k">def</span> <span class="nf">fisher_covar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Fisher matrix M as defined in the accompanying documentation,</span>
<span class="sd">        marginalized over the complex station gains. Intelligently avoids </span>
<span class="sd">        recomputation if the observation and parameters are unchanged.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (Obsdata): An Obsdata object containing the observation particulars.</span>
<span class="sd">          p (list): List of model parameters at which to compute the Fisher matrix.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          M (np.ndarray): The Fisher matrix M.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Get the fisher covariance </span>
        <span class="n">new_argument_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">new_argument_hash</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">covar</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="n">new_argument_hash</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">covar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
                <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">switch_polrep</span><span class="p">(</span><span class="s1">&#39;stokes&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generate_gain_epochs</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">gain_amplitude_priors</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">gain_phase_priors</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gain amplitude dicts -- global:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gain amplitude dicts -- local: &quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="p">)</span>
                    
                
                <span class="k">for</span> <span class="n">ige</span><span class="p">,</span><span class="n">ge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_epochs</span><span class="p">)</span> <span class="p">:</span>
                    <span class="k">with</span> <span class="n">ploop</span><span class="o">.</span><span class="n">HiddenPrints</span><span class="p">():</span>
                        <span class="n">obs_ge</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">flag_UT_range</span><span class="p">(</span><span class="n">UT_start_hour</span><span class="o">=</span><span class="n">ge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">UT_stop_hour</span><span class="o">=</span><span class="n">ge</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;flagged&#39;</span><span class="p">)</span>

                    <span class="n">gradV_wgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">visibility_gradients</span><span class="p">(</span><span class="n">obs_ge</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">covar_wgs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
                    
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                            <span class="n">covar_wgs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">gradV_wgs</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">gradV_wgs</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">obs_ge</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">gradV_wgs</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">gradV_wgs</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">obs_ge</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                            <span class="n">covar_wgs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">2.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
                            
                    <span class="n">n</span> <span class="o">=</span> <span class="n">covar_wgs</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">,:</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">covar_wgs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">:,:</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">covar_wgs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">:,</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">:]</span>
                    <span class="n">r</span><span class="p">,</span><span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condition_vM</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
                    <span class="n">mn</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">_invert_matrix</span><span class="p">(</span><span class="n">m</span><span class="p">),</span><span class="n">r</span><span class="p">))</span>
                    
                    <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gain epoch </span><span class="si">%g</span><span class="s2"> of </span><span class="si">%g</span><span class="s2"> ----------------------&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ige</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_epochs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;obs stations:&quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">obs_ge</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">])</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">obs_ge</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">])))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;obs times:&quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">obs_ge</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;obs data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">obs_ge</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gradV gains:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">gradV_wgs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:])</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;covar:&quot;</span><span class="p">)</span>
                        <span class="n">_print_matrix</span><span class="p">(</span><span class="n">covar_wgs</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n:&quot;</span><span class="p">)</span>
                        <span class="n">_print_matrix</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;r:&quot;</span><span class="p">)</span>
                        <span class="n">_print_matrix</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;m:&quot;</span><span class="p">)</span>
                        <span class="n">_print_matrix</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;minv:&quot;</span><span class="p">)</span>
                        <span class="n">_print_matrix</span><span class="p">(</span><span class="n">_invert_matrix</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;marginalized n:&quot;</span><span class="p">)</span>
                        <span class="n">_print_matrix</span><span class="p">(</span><span class="n">mn</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;marginalized/symmetrized n:&quot;</span><span class="p">)</span>
                        <span class="n">_print_matrix</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">mn</span><span class="o">+</span><span class="n">mn</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

                    <span class="c1">#quit()</span>

                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">covar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covar</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">mn</span><span class="o">+</span><span class="n">mn</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">switch_polrep</span><span class="p">(</span><span class="s1">&#39;circ&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generate_gain_epochs</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">gain_amplitude_priors</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">gain_phase_priors</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">gain_ratio_amplitude_priors</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_amplitude_priors</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">gain_ratio_phase_priors</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_phase_priors</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gain amplitude dicts -- global:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gain amplitude dicts -- local: &quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gain phase dicts -- global:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gain phase dicts -- local: &quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">gain_phase_priors</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gain ratio amplitude dicts -- global:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_amplitude_priors</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gain ratio amplitude dicts -- local: &quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">gain_ratio_amplitude_priors</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gain ratio phase dicts -- global:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_phase_priors</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gain ratio phase dicts -- local: &quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">gain_ratio_phase_priors</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">ige</span><span class="p">,</span><span class="n">ge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_epochs</span><span class="p">)</span> <span class="p">:</span>
                    <span class="k">with</span> <span class="n">ploop</span><span class="o">.</span><span class="n">HiddenPrints</span><span class="p">():</span>
                        <span class="n">obs_ge</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">flag_UT_range</span><span class="p">(</span><span class="n">UT_start_hour</span><span class="o">=</span><span class="n">ge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">UT_stop_hour</span><span class="o">=</span><span class="n">ge</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;flagged&#39;</span><span class="p">)</span>

                    <span class="n">gradRR_wgs</span><span class="p">,</span> <span class="n">gradLL_wgs</span><span class="p">,</span> <span class="n">gradRL_wgs</span><span class="p">,</span> <span class="n">gradLR_wgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">visibility_gradients</span><span class="p">(</span><span class="n">obs_ge</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">covar_wgs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>

                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                            <span class="n">covar_wgs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">gradRR_wgs</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">gradRR_wgs</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">obs_ge</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rrsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">gradRR_wgs</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">gradRR_wgs</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">obs_ge</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rrsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                            <span class="n">covar_wgs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">gradLL_wgs</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">gradLL_wgs</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">obs_ge</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;llsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">gradLL_wgs</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">gradLL_wgs</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">obs_ge</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;llsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                            <span class="n">covar_wgs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">gradRL_wgs</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">gradRL_wgs</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">obs_ge</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rlsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">gradRL_wgs</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">gradRL_wgs</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">obs_ge</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rlsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                            <span class="n">covar_wgs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">gradLR_wgs</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">gradLR_wgs</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">obs_ge</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lrsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">gradLR_wgs</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">gradLR_wgs</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">obs_ge</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lrsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                            <span class="n">covar_wgs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">2.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_cgse</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>

                    <span class="n">n</span> <span class="o">=</span> <span class="n">covar_wgs</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">,:</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">covar_wgs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">:,:</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">covar_wgs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">:,</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">:]</span>
                    <span class="n">r</span><span class="p">,</span><span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condition_vM</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
                    <span class="n">mn</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">_invert_matrix</span><span class="p">(</span><span class="n">m</span><span class="p">),</span><span class="n">r</span><span class="p">))</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">covar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covar</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">mn</span><span class="o">+</span><span class="n">mn</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">2.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># Why factor of 2?</span>
                    
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">covar</span></div>
    
<div class="viewcode-block" id="FF_complex_gains.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_complex_gains.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameter labels to be used in plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          plabels (list): list of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">parameter_labels</span><span class="p">()</span></div>

<div class="viewcode-block" id="FF_complex_gains.set_gain_amplitude_prior"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_complex_gains.set_gain_amplitude_prior">[docs]</a>    <span class="k">def</span> <span class="nf">set_gain_amplitude_prior</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">station</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the log-normal priors on the gain amplitudes, either for a</span>
<span class="sd">        specified station or for all stations. Identical priors are </span>
<span class="sd">        assummed across the entire observation.</span>

<span class="sd">        Args:</span>
<span class="sd">          sigma (float): Standard deviation of the log-amplitude.</span>
<span class="sd">          station (str,list): Station code of the station(s) for which the prior is to be set. If None, will set the prior on all stations. Default: None.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span><span class="mf">10.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">station</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;All&#39;</span><span class="p">:</span><span class="n">sigma</span><span class="p">}</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gain amplitude dict:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_amplitude_priors</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FF_complex_gains.set_gain_phase_prior"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_complex_gains.set_gain_phase_prior">[docs]</a>    <span class="k">def</span> <span class="nf">set_gain_phase_prior</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">station</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the normal priors on the gain phases, either for a specified </span>
<span class="sd">        station or for all stations. Usually, this should be the default</span>
<span class="sd">        (uniformative). Identical priors are assummed across the entire </span>
<span class="sd">        observation.</span>

<span class="sd">        Args:</span>
<span class="sd">          sigma (float): Standard deviation of the phase.</span>
<span class="sd">          station (str,list): Station code of the station(s) for which the prior is to be set. If None, will set the prior on all stations. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span><span class="mf">100.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">station</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;All&#39;</span><span class="p">:</span><span class="n">sigma</span><span class="p">}</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gain phase dict:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_phase_priors</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FF_complex_gains.set_gain_ratio_amplitude_prior"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_complex_gains.set_gain_ratio_amplitude_prior">[docs]</a>    <span class="k">def</span> <span class="nf">set_gain_ratio_amplitude_prior</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">station</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the log-normal priors on the R/L gain amplitude ratios, either </span>
<span class="sd">        for a specified station or for all stations. Only relevant for</span>
<span class="sd">        polarized models. Default: 1e-10 for all stations. Identical priors </span>
<span class="sd">        are assummed across the entire observation.</span>

<span class="sd">        Args:</span>
<span class="sd">          sigma (float): Standard deviation of the log-amplitude ratio.</span>
<span class="sd">          station (str,list): Station code of the station(s) for which the prior is to be set. If None, will set the prior on all stations. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span><span class="mf">100.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">station</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_amplitude_priors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;All&#39;</span><span class="p">:</span><span class="n">sigma</span><span class="p">}</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_amplitude_priors</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gain ratio amplitude dict:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_amplitude_priors</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FF_complex_gains.set_gain_ratio_phase_prior"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_complex_gains.set_gain_ratio_phase_prior">[docs]</a>    <span class="k">def</span> <span class="nf">set_gain_ratio_phase_prior</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">station</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the normal priors on the R/L gain phase differences, either </span>
<span class="sd">        for a specified station or for all stations. Only relevant for</span>
<span class="sd">        polarized models. Default: 1e-10 for all stations. Identical priors </span>
<span class="sd">        are assummed across the entire observation.</span>

<span class="sd">        Args:</span>
<span class="sd">          sigma (float): Standard deviation of the phase.</span>
<span class="sd">          station (str,list): Station code of the station(s) for which the prior is to be set. If None, will set the prior on all stations. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span><span class="mf">100.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">station</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_phase_priors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;All&#39;</span><span class="p">:</span><span class="n">sigma</span><span class="p">}</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_phase_priors</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gain ratio phase dict:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_ratio_phase_priors</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="kc">None</span></div></div>
        
    
<div class="viewcode-block" id="FF_model_image"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_model_image">[docs]</a><span class="k">class</span> <span class="nc">FF_model_image</span><span class="p">(</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FisherForecast from ThemisyPy model_image objects. Uses FFTs and centered </span>
<span class="sd">    finite-difference to compute the visibilities and gradients. May not always</span>
<span class="sd">    produce sensible behaviors. Has not been extensively tested for some time.</span>

<span class="sd">    Args:</span>
<span class="sd">      img (model_image): A ThemisPy model_image object.</span>
<span class="sd">      stokes (str): Indicates if this is limited to Stokes I (&#39;I&#39;) or include full polarization (&#39;full&#39;). Default: &#39;I&#39;.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      img (model_image): The ThemisPy model_image object for which to make forecasts.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">img</span><span class="p">,</span><span class="n">stokes</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="n">stokes</span>

<div class="viewcode-block" id="FF_model_image.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_model_image.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibilities associated with a given model image object.  Note </span>
<span class="sd">        that this uses FFTs to create the visibilities and then interpolates.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          limits (list): May be single number, list with four elements specifying in :math:`\\mu as` the symmetric limits or explicit limits in [xmin,xmax,ymin,ymax] order.  Default: 100.</span>
<span class="sd">          shape (list): May be single number or list with two elements indicating the number of pixels in the two directions.  Default: 256.</span>
<span class="sd">          padding (int): Factor by which to pad image with zeros prior to FFT.  Default: 4.</span>
<span class="sd">          verbosity (int): Verbosity level. 0 prints nothing. 1 prints various elements of the plotting process. Passed to :func:`model_image.generate_intensity_map`. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          V (np.array): list of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized visibilities for FF_model_image are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="c1"># Generate the image at current location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="c1"># Fix image limits</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">limits</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="n">limits</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">limits</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="o">-</span><span class="n">limits</span><span class="p">,</span> <span class="n">limits</span><span class="p">]</span>

        <span class="c1"># Set shape</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">shape</span><span class="p">,</span> <span class="n">shape</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;limits:&quot;</span><span class="p">,</span><span class="n">limits</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;shape:&quot;</span><span class="p">,</span><span class="n">shape</span><span class="p">)</span>
            
        <span class="c1"># Generate a set of pixels</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span><span class="n">limits</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">limits</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">]</span>
        <span class="c1"># Generate a set of intensities (Jy/uas^2)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">intensity_map</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="n">V00_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])))</span>

        <span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">uas2rad</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">uas2rad</span>
        
        <span class="c1"># Generate the complex visibilities, gridded</span>
        <span class="n">V2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">padding</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shape</span><span class="p">))))</span>
        <span class="n">u1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">padding</span><span class="o">*</span><span class="n">I</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])))</span>
        <span class="n">v1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">padding</span><span class="o">*</span><span class="n">I</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])))</span>
        
        <span class="c1"># Center image</span>
        <span class="n">i2d</span><span class="p">,</span><span class="n">j2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">V2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">V2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">V2d</span> <span class="o">=</span> <span class="n">V2d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">i2d</span><span class="o">+</span><span class="n">j2d</span><span class="p">))</span>
        
        
        <span class="c1"># Generate the interpolator and interpolate to the u,v list</span>
        <span class="n">Vrinterp</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">RectBivariateSpline</span><span class="p">(</span><span class="n">u1d</span><span class="p">,</span><span class="n">v1d</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V2d</span><span class="p">))</span>
        <span class="n">Viinterp</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">RectBivariateSpline</span><span class="p">(</span><span class="n">u1d</span><span class="p">,</span><span class="n">v1d</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V2d</span><span class="p">))</span>

        <span class="n">V00_fft</span> <span class="o">=</span> <span class="n">Vrinterp</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">V2d</span> <span class="o">=</span> <span class="n">V2d</span> <span class="o">*</span> <span class="n">V00_img</span><span class="o">/</span><span class="n">V00_fft</span>
        
        <span class="n">V</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">u</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Vrinterp</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">Viinterp</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">V</span></div>
            
<div class="viewcode-block" id="FF_model_image.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_model_image.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibilities associated with a given model image object.  Note </span>
<span class="sd">        that this uses FFTs to create the visibilities and then interpolates.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          h (float): fractional step for finite-difference gradient computation.  Default: 0.01.</span>
<span class="sd">          limits (list): May be single number, list with four elements specifying in :math:`\\mu as` the symmetric limits or explicit limits in [xmin,xmax,ymin,ymax] order.  Default: 100.</span>
<span class="sd">          shape (list): May be single number or list with two elements indicating the number of pixels in the two directions.  Default: 256.</span>
<span class="sd">          padding (int): Factor by which to pad image with zeros prior to FFT.  Default: 4.</span>
<span class="sd">          verbosity (int): Verbosity level. 0 prints nothing. 1 prints various elements of the plotting process. Passed to :func:`model_image.generate_intensity_map`. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          gradV (np.ndarray): list of complex visibilities gradients computed at observation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized gradients for FF_model_image are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">pp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">gradV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">hq</span> <span class="o">=</span> <span class="n">h</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">hq</span> <span class="o">=</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">pp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">hq</span>
            <span class="n">Vmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">pp</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">))</span>
            <span class="n">pp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">hq</span>
            <span class="n">Vmm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">pp</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">))</span>
            <span class="n">pp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">gradV</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Vmp</span><span class="o">-</span><span class="n">Vmm</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">hq</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">gradV</span></div>

<div class="viewcode-block" id="FF_model_image.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_model_image.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameter labels to be used in plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          plabels (list): list of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">parameter_name_list</span><span class="p">()</span></div></div>
    

<div class="viewcode-block" id="FF_smoothed_delta_ring"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_smoothed_delta_ring">[docs]</a><span class="k">class</span> <span class="nc">FF_smoothed_delta_ring</span><span class="p">(</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FisherForecast object for a delta-ring convolved with a circular Gaussian.</span>
<span class="sd">    Parameter vector is:</span>
<span class="sd">      p[0] ... Total flux in Jy.</span>
<span class="sd">      p[1] ... Diameter in uas.</span>
<span class="sd">      p[2] ... Twice the standard deviation of the Gaussian smoothing kernel in uas.</span>

<span class="sd">    Args:</span>
<span class="sd">      stokes (str): Indicates if this is limited to Stokes I (&#39;I&#39;) or include full polarization (&#39;full&#39;). Default: &#39;I&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stokes</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="n">stokes</span>
        
<div class="viewcode-block" id="FF_smoothed_delta_ring.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_smoothed_delta_ring.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibilities associated with Gaussian-convolved delta-ring.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          V (np.array): list of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... flux in Jy</span>
        <span class="c1">#  p[1] ... diameter in uas</span>
        <span class="c1">#  p[2] ... width in uas</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized visibilities for FF_smoothed_delta_ring are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
        
        <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> 
        <span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>
        <span class="n">piuv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">uas2rad</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">piuv</span><span class="o">*</span><span class="n">d</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">piuv</span><span class="o">*</span><span class="n">w</span>
        <span class="n">J0</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">J1</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">J0</span> <span class="o">*</span> <span class="n">ey2</span>
        <span class="k">return</span> <span class="n">V</span></div>
        
<div class="viewcode-block" id="FF_smoothed_delta_ring.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_smoothed_delta_ring.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibility gradients associated with Gaussian-convolved delta-ring.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          gradV (np.array): list of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... flux in Jy</span>
        <span class="c1">#  p[1] ... diameter in uas</span>
        <span class="c1">#  p[2] ... width in uas</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized gradients for FF_smoothed_delta_ring are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
                
        <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>
        <span class="n">piuv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">uas2rad</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">piuv</span><span class="o">*</span><span class="n">d</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">piuv</span><span class="o">*</span><span class="n">w</span>
        <span class="n">J0</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">J1</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">gradV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">J0</span><span class="o">*</span><span class="n">ey2</span><span class="p">,</span>  <span class="c1"># dV/dp[0]</span>
                           <span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">piuv</span><span class="o">*</span><span class="n">J1</span><span class="o">*</span><span class="n">ey2</span><span class="p">,</span> <span class="c1"># dV/dd</span>
                           <span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">piuv</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">J0</span><span class="o">*</span><span class="n">ey2</span> <span class="p">])</span> <span class="c1"># dV/dw</span>

        <span class="k">return</span> <span class="n">gradV</span><span class="o">.</span><span class="n">T</span></div>
        

<div class="viewcode-block" id="FF_smoothed_delta_ring.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_smoothed_delta_ring.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameter labels to be used in plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          plabels (list): list of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">return</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\delta F~({\rm Jy})$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\delta d~(\mu{\rm as})$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\delta w~(\mu{\rm as})$&#39;</span><span class="p">]</span></div></div>
    

<div class="viewcode-block" id="FF_symmetric_gaussian"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_symmetric_gaussian">[docs]</a><span class="k">class</span> <span class="nc">FF_symmetric_gaussian</span><span class="p">(</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FisherForecast object for a circular Gaussian.</span>
<span class="sd">    Parameter vector is:</span>
<span class="sd">      p[0] ... Total flux in Jy.</span>
<span class="sd">      p[1] ... FWHM in uas.</span>

<span class="sd">    Args:</span>
<span class="sd">      stokes (str): Indicates if this is limited to Stokes I (&#39;I&#39;) or include full polarization (&#39;full&#39;). Default: &#39;I&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stokes</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="n">stokes</span>
        
<div class="viewcode-block" id="FF_symmetric_gaussian.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_symmetric_gaussian.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibilities associated with a circular Gaussian.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          V (np.array): list of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... flux in Jy</span>
        <span class="c1">#  p[1] ... diameter in uas</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized visibilities for FF_symmetric_gaussian are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>
        <span class="n">piuv</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">uas2rad</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">8.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">piuv</span> <span class="o">*</span> <span class="n">d</span>
        <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ey2</span></div>
        
<div class="viewcode-block" id="FF_symmetric_gaussian.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_symmetric_gaussian.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibility gradients associated with a circular Gaussian.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          gradV (np.array): list of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... flux in Jy</span>
        <span class="c1">#  p[1] ... diameter in uas</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized gradients for FF_symmetric_gaussian are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>
        <span class="n">piuv</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">uas2rad</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">8.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">piuv</span> <span class="o">*</span> <span class="n">d</span>
        <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">gradV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">ey2</span><span class="p">,</span> <span class="c1"># dV/dp[0]</span>
                           <span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">piuv</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="n">ey2</span> <span class="p">])</span> <span class="c1"># dV/dd</span>

        <span class="k">return</span> <span class="n">gradV</span><span class="o">.</span><span class="n">T</span></div>
        

<div class="viewcode-block" id="FF_symmetric_gaussian.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_symmetric_gaussian.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameter labels to be used in plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          plabels (list): list of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">return</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\delta F~({\rm Jy})$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\delta FWHM~(\mu{\rm as})$&#39;</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="FF_asymmetric_gaussian"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_asymmetric_gaussian">[docs]</a><span class="k">class</span> <span class="nc">FF_asymmetric_gaussian</span><span class="p">(</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FisherForecast object for a noncircular Gaussian.  </span>
<span class="sd">    Parameter vector is:</span>
<span class="sd">      p[0] ... Total flux in Jy.</span>
<span class="sd">      p[1] ... Symmetrized mean of the FHWM in the major and minor axes in uas.</span>
<span class="sd">      p[2] ... Asymmetry parameter, A, expected to be in the range [0,1).</span>
<span class="sd">      p[3] ... Position angle in radians.</span>
<span class="sd">    The major axis FWHM is p[1]/sqrt(1-A); the minor axis FWHM is p[1]/sqrt(1+A).</span>

<span class="sd">    Args:</span>
<span class="sd">      stokes (str): Indicates if this is limited to Stokes I (&#39;I&#39;) or include full polarization (&#39;full&#39;). Default: &#39;I&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stokes</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="n">stokes</span>
        
<div class="viewcode-block" id="FF_asymmetric_gaussian.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_asymmetric_gaussian.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibilities associated with a noncircular Gaussian.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          V (np.array): list of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... flux in Jy</span>
        <span class="c1">#  p[1] ... mean diameter in uas</span>
        <span class="c1">#  p[2] ... asymmetry parameter </span>
        <span class="c1">#  p[3] ... position angle in radians</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized visibilities for FF_asymmetric_gaussian are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>

        <span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>
        
        <span class="n">F</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">uas2rad</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">8.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">cpa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">spa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">ur</span> <span class="o">=</span> <span class="n">cpa</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">spa</span><span class="o">*</span><span class="n">v</span>
        <span class="n">vr</span> <span class="o">=</span> <span class="o">-</span><span class="n">spa</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">cpa</span><span class="o">*</span><span class="n">v</span>

        <span class="n">sigmaj</span> <span class="o">=</span> <span class="n">sig</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">A</span><span class="p">)</span>
        <span class="n">sigmin</span> <span class="o">=</span> <span class="n">sig</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">A</span><span class="p">)</span>

        <span class="n">pimaj</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">ur</span>
        <span class="n">pimin</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">vr</span>

        <span class="n">ymaj</span> <span class="o">=</span> <span class="n">pimaj</span><span class="o">*</span><span class="n">sigmaj</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">pimin</span><span class="o">*</span><span class="n">sigmin</span>

        <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">ymaj</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ymin</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">F</span><span class="o">*</span><span class="n">ey2</span></div>

    
<div class="viewcode-block" id="FF_asymmetric_gaussian.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_asymmetric_gaussian.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibility gradients associated with a noncircular Gaussian.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          V (np.array): list of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... flux in Jy</span>
        <span class="c1">#  p[1] ... mean diameter in uas</span>
        <span class="c1">#  p[2] ... asymmetry parameter </span>
        <span class="c1">#  p[3] ... position angle in radians</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized gradients for FF_asymmetric_gaussian are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>

        <span class="n">uas2rad_fwhm2sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">8.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>
        
        <span class="n">F</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">cpa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">spa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">ur</span> <span class="o">=</span> <span class="n">cpa</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">spa</span><span class="o">*</span><span class="n">v</span>
        <span class="n">vr</span> <span class="o">=</span> <span class="o">-</span><span class="n">spa</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">cpa</span><span class="o">*</span><span class="n">v</span>

        <span class="n">sigmaj</span> <span class="o">=</span> <span class="n">sig</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">A</span><span class="p">)</span>
        <span class="n">sigmin</span> <span class="o">=</span> <span class="n">sig</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">A</span><span class="p">)</span>

        <span class="n">pimaj</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">ur</span> <span class="o">*</span> <span class="n">uas2rad_fwhm2sig</span> 
        <span class="n">pimin</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">vr</span> <span class="o">*</span> <span class="n">uas2rad_fwhm2sig</span> 

        <span class="n">ymaj</span> <span class="o">=</span> <span class="n">pimaj</span><span class="o">*</span><span class="n">sigmaj</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">pimin</span><span class="o">*</span><span class="n">sigmin</span>

        <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">ymaj</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ymin</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">gradV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">ey2</span><span class="p">,</span> <span class="c1"># dV/dF</span>
                           <span class="o">-</span><span class="n">F</span><span class="o">*</span><span class="n">ey2</span><span class="o">*</span><span class="p">(</span> <span class="n">pimaj</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">sig</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">A</span><span class="p">)</span> <span class="o">+</span> <span class="n">pimin</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">sig</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">A</span><span class="p">)</span> <span class="p">),</span> <span class="c1"># dV/dd</span>
                           <span class="o">-</span><span class="n">F</span><span class="o">*</span><span class="n">ey2</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="n">pimaj</span><span class="o">*</span><span class="n">sig</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">A</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">pimin</span><span class="o">*</span><span class="n">sig</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">A</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">),</span> <span class="c1"># dV/dA</span>
                           <span class="o">-</span><span class="n">F</span><span class="o">*</span><span class="n">ey2</span><span class="o">*</span> <span class="n">pimaj</span><span class="o">*</span><span class="n">pimin</span> <span class="o">*</span> <span class="p">(</span> <span class="n">sigmaj</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">sigmin</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="p">])</span>
        
        
        <span class="k">return</span> <span class="n">gradV</span><span class="o">.</span><span class="n">T</span></div>

<div class="viewcode-block" id="FF_asymmetric_gaussian.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_asymmetric_gaussian.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameter labels to be used in plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          plabels (list): list of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">return</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\delta F~({\rm Jy})$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\delta FWHM~(\mu{\rm as})$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\delta A$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\delta {\rm PA}~({\rm rad})$&#39;</span><span class="p">]</span></div></div>

    

<div class="viewcode-block" id="FF_splined_raster"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_splined_raster">[docs]</a><span class="k">class</span> <span class="nc">FF_splined_raster</span><span class="p">(</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FisherForecast object for a splined raster (i.e., themage).</span>
<span class="sd">    Parameter vector is the log of the intensity at the control points:</span>
<span class="sd">      p[0] ....... ln(I[0,0])</span>
<span class="sd">      p[1] ....... ln(I[1,0])</span>
<span class="sd">       ...</span>
<span class="sd">      p[N-1] ..... ln(I[N-1,0])</span>
<span class="sd">      p[N] ....... ln(I[0,1])</span>
<span class="sd">       ...</span>
<span class="sd">      p[N*N-1] ... ln(I[N-1,N-1])</span>
<span class="sd">    where each I[i,j] is measured in Jy/sr.</span>

<span class="sd">    Args:</span>
<span class="sd">      N (int): Raster dimension (only supports square raster).</span>
<span class="sd">      fov (float): Raster field of view in uas (only supports fixed rasters).</span>
<span class="sd">      stokes (str): Indicates if this is limited to Stokes I (&#39;I&#39;) or include full polarization (&#39;full&#39;). Default: &#39;I&#39;.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      xcp (np.ndarray): x-positions of raster control points.</span>
<span class="sd">      ycp (np.ndarray): y-positions of raster control points.</span>
<span class="sd">      apx (float): Raster pixel size.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">fov</span><span class="p">,</span><span class="n">stokes</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npx</span> <span class="o">=</span> <span class="n">N</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">fov</span> <span class="o">=</span> <span class="n">fov</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="mf">3600e6</span><span class="o">*</span><span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fov</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fov</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fov</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fov</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">apx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="n">stokes</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">*=</span> <span class="mi">4</span>

<div class="viewcode-block" id="FF_splined_raster.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_splined_raster.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibilities associated with a splined raster model.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          V (np.array): list of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... p[0,0]</span>
        <span class="c1">#  p[1] ... p[1,0]</span>
        <span class="c1">#  ...</span>
        <span class="c1">#  p[NxN-1] = p[N-1,N-1]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized visibilities for FF_splined_raster are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
        
        <span class="c1"># Add themage</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">u</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">V</span> <span class="o">=</span> <span class="n">V</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span>
            <span class="k">return</span> <span class="n">V</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">u</span>
            <span class="n">Q</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">u</span>
            <span class="n">U</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">u</span>
            <span class="n">V</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">u</span>

            <span class="n">countI</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">I</span> <span class="o">=</span> <span class="n">I</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span>
                    <span class="n">countI</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">Q</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">countI</span> <span class="o">+</span> <span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span>
                    <span class="n">U</span> <span class="o">=</span> <span class="n">U</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">countI</span> <span class="o">+</span> <span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span>
                    <span class="n">V</span> <span class="o">=</span> <span class="n">V</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">countI</span> <span class="o">+</span> <span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span>

            <span class="n">RR</span> <span class="o">=</span> <span class="n">I</span> <span class="o">+</span> <span class="n">V</span>
            <span class="n">LL</span> <span class="o">=</span> <span class="n">I</span> <span class="o">-</span> <span class="n">V</span>
            <span class="n">RL</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">U</span>
            <span class="n">LR</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.0</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">U</span>

            <span class="k">return</span> <span class="n">RR</span><span class="p">,</span> <span class="n">LL</span><span class="p">,</span> <span class="n">RL</span><span class="p">,</span> <span class="n">LR</span></div>
        
<div class="viewcode-block" id="FF_splined_raster.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_splined_raster.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibility gradients associated with a splined raster model.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          gradV (np.array): list of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... p[0,0]</span>
        <span class="c1">#  p[1] ... p[1,0]</span>
        <span class="c1">#  ...</span>
        <span class="c1">#  p[NxN-1] = p[N-1,N-1]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized gradients for FF_splined_raster are not yet implemented!&#39;</span><span class="p">))</span>
        
        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
        
        <span class="c1"># Add themage</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="n">gradV</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">gradV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span> <span class="p">)</span>
            <span class="n">gradV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradV</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">gradV</span><span class="o">.</span><span class="n">T</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gradI</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">gradQ</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">gradU</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">gradV</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            
            <span class="n">countI</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">gradI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span> <span class="p">)</span>
                    <span class="n">countI</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">gradQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">countI</span> <span class="o">+</span> <span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span> <span class="p">)</span>
                    <span class="n">gradU</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">countI</span> <span class="o">+</span> <span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span> <span class="p">)</span>
                    <span class="n">gradV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">countI</span> <span class="o">+</span> <span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span> <span class="p">)</span>
            <span class="n">gradI_small</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradI</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">gradQ_small</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradQ</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">gradU_small</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradU</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">gradV_small</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradV</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

            <span class="n">gradI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">block</span><span class="p">([</span><span class="mf">1.0</span><span class="o">*</span><span class="n">gradI_small</span><span class="p">,</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradQ_small</span><span class="p">,</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradU_small</span><span class="p">,</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradV_small</span><span class="p">])</span>
            <span class="n">gradQ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">block</span><span class="p">([</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradI_small</span><span class="p">,</span><span class="mf">1.0</span><span class="o">*</span><span class="n">gradQ_small</span><span class="p">,</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradU_small</span><span class="p">,</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradV_small</span><span class="p">])</span>
            <span class="n">gradU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">block</span><span class="p">([</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradI_small</span><span class="p">,</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradQ_small</span><span class="p">,</span><span class="mf">1.0</span><span class="o">*</span><span class="n">gradU_small</span><span class="p">,</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradV_small</span><span class="p">])</span>
            <span class="n">gradV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">block</span><span class="p">([</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradI_small</span><span class="p">,</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradQ_small</span><span class="p">,</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradU_small</span><span class="p">,</span><span class="mf">1.0</span><span class="o">*</span><span class="n">gradV_small</span><span class="p">])</span>

            <span class="n">grad_RR</span> <span class="o">=</span> <span class="n">gradI</span> <span class="o">+</span> <span class="n">gradV</span>
            <span class="n">grad_LL</span> <span class="o">=</span> <span class="n">gradI</span> <span class="o">-</span> <span class="n">gradV</span>
            <span class="n">grad_RL</span> <span class="o">=</span> <span class="n">gradQ</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">gradU</span>
            <span class="n">grad_LR</span> <span class="o">=</span> <span class="n">gradQ</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.0</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">gradU</span>
            
            <span class="k">return</span> <span class="n">grad_RR</span><span class="p">,</span> <span class="n">grad_LL</span><span class="p">,</span> <span class="n">grad_RL</span><span class="p">,</span> <span class="n">grad_LR</span></div>


<div class="viewcode-block" id="FF_splined_raster.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_splined_raster.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameter labels to be used in plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          plabels (list): list of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">pll</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;$\delta I_{</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">}$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;$\delta Q_{</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">}$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;$\delta U_{</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">}$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;$\delta V_{</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">}$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">pll</span></div>

<div class="viewcode-block" id="FF_splined_raster.generate_parameter_list"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_splined_raster.generate_parameter_list">[docs]</a>    <span class="k">def</span> <span class="nf">generate_parameter_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">glob</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility function to quickly and easily generate a set of raster values</span>
<span class="sd">        associated with various potential initialization schemes. These include:</span>
<span class="sd">        an existing FisherForecast object, a FisherForecast class, or a FITS file</span>
<span class="sd">        name.</span>

<span class="sd">        TBD.</span>

<span class="sd">        Args:</span>
<span class="sd">          glob (str): Can be an existing FisherForecast child object, the name of a FisherForecast child class, or a string with a FITS file name.</span>
<span class="sd">          p (list): If glob is a FisherForecast child object or the name of a FisherForecast child class, a parameter list must be passed from which the image will be generated.</span>
<span class="sd">          </span>
<span class="sd">        Returns:</span>
<span class="sd">          p (list): Approximate parameter list for associated splined raster object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">glob</span><span class="p">),</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="c1"># This is a FF object, set the parameters, make the images and go</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="p">(</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">glob</span><span class="p">,</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="c1"># This is a FF class, create a FF obj set the parameters, make the images and go</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">glob</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="c1"># This is a string, check for .fits and go</span>
            <span class="k">pass</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unrecognized glob from which to generate acceptable parameter list.&quot;</span><span class="p">))</span>                  
        
        <span class="k">pass</span></div></div>

    

<div class="viewcode-block" id="FF_smoothed_delta_ring_themage"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_smoothed_delta_ring_themage">[docs]</a><span class="k">class</span> <span class="nc">FF_smoothed_delta_ring_themage</span><span class="p">(</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FisherForecast object for a splined raster (i.e., themage) plus a</span>
<span class="sd">    Gaussian-convolved delta-ring.</span>

<span class="sd">    Parameter vector is the log of the intensity at the control points:</span>
<span class="sd">      p[0] ....... ln(I[0,0])</span>
<span class="sd">      p[1] ....... ln(I[1,0])</span>
<span class="sd">       ...</span>
<span class="sd">      p[N-1] ..... ln(I[N-1,0])</span>
<span class="sd">      p[N] ....... ln(I[0,1])</span>
<span class="sd">       ...</span>
<span class="sd">      p[N*N-1] ... ln(I[N-1,N-1])</span>
<span class="sd">      p[N*N+0] ... Total flux in Jy.</span>
<span class="sd">      p[N*N+1] ... Diameter in uas.</span>
<span class="sd">      p[N*N+2] ... Twice the standard deviation of the Gaussian smoothing kernel in uas.</span>

<span class="sd">    where each I[i,j] is measured in Jy/sr.</span>

<span class="sd">    Args:</span>
<span class="sd">      N (int): Raster dimension (only supports square raster).</span>
<span class="sd">      fov (float): Raster field of view in uas (only supports fixed rasters).</span>
<span class="sd">      stokes (str): Indicates if this is limited to Stokes I (&#39;I&#39;) or include full polarization (&#39;full&#39;). Default: &#39;I&#39;.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      xcp (np.ndarray): x-positions of raster control points.</span>
<span class="sd">      ycp (np.ndarray): y-positions of raster control points.</span>
<span class="sd">      apx (float): Raster pixel size.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">fov</span><span class="p">,</span><span class="n">stokes</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npx</span> <span class="o">=</span> <span class="n">N</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span>
        <span class="n">fov</span> <span class="o">=</span> <span class="n">fov</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="mf">3600e6</span><span class="o">*</span><span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fov</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fov</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fov</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fov</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">apx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="n">stokes</span>

<div class="viewcode-block" id="FF_smoothed_delta_ring_themage.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_smoothed_delta_ring_themage.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibilities associated with splined raster + Gaussian-convolved delta-ring.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          V (np.array): list of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... p[0,0]</span>
        <span class="c1">#  p[1] ... p[1,0]</span>
        <span class="c1">#  ...</span>
        <span class="c1">#  p[NxN-1] = p[N-1,N-1]</span>
        <span class="c1">#  p[NxN+0] ... ring flux in Jy</span>
        <span class="c1">#  p[NxN+1] ... ring diameter in uas</span>
        <span class="c1">#  p[NxN+2] ... ring width in uas</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized visibilities for FF_smoothed_delta_ring_themage are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>

        <span class="n">V</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">u</span>

        <span class="c1"># print(&quot;p:&quot;,p)</span>
        
        <span class="c1"># Add themage</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">V</span> <span class="o">=</span> <span class="n">V</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span>

        <span class="c1"># print(u[:5],v[:5],V[:5])</span>

                
        <span class="c1"># Add ring</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>
        <span class="n">piuv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">uas2rad</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">piuv</span><span class="o">*</span><span class="n">d</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">piuv</span><span class="o">*</span><span class="n">w</span>
        <span class="n">J0</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">J1</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">V</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">J0</span> <span class="o">*</span> <span class="n">ey2</span>
        
        <span class="k">return</span> <span class="n">V</span></div>
        
<div class="viewcode-block" id="FF_smoothed_delta_ring_themage.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_smoothed_delta_ring_themage.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibility gradients associated with splined-raster + Gaussian-convolved delta-ring.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          gradV (np.array): list of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... p[0,0]</span>
        <span class="c1">#  p[1] ... p[1,0]</span>
        <span class="c1">#  ...</span>
        <span class="c1">#  p[NxN-1] = p[N-1,N-1]</span>
        <span class="c1">#  p[NxN+0] ... ring flux in Jy</span>
        <span class="c1">#  p[NxN+1] ... ring diameter in uas</span>
        <span class="c1">#  p[NxN+2] ... ring width in uas</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized gradients for FF_smoothed_delta_ring_themage are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>

        <span class="n">gradV</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Add themage</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">gradV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">ty</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span> <span class="p">)</span>
        
        <span class="c1"># Add ring</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>
        <span class="n">piuv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">uas2rad</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">piuv</span><span class="o">*</span><span class="n">d</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">piuv</span><span class="o">*</span><span class="n">w</span>
        <span class="n">J0</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">J1</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">gradV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">J0</span><span class="o">*</span><span class="n">ey2</span> <span class="p">)</span> <span class="c1"># dV/dF</span>
        <span class="n">gradV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">piuv</span><span class="o">*</span><span class="n">J1</span><span class="o">*</span><span class="n">ey2</span> <span class="p">)</span> <span class="c1"># dV/dd</span>
        <span class="n">gradV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">piuv</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">J0</span><span class="o">*</span><span class="n">ey2</span> <span class="p">)</span> <span class="c1"># dV/dw</span>

        <span class="n">gradV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradV</span><span class="p">)</span>
        
        <span class="c1"># print(&quot;FOO:&quot;,gradV.shape)</span>
        
        <span class="k">return</span> <span class="n">gradV</span><span class="o">.</span><span class="n">T</span></div>
        

<div class="viewcode-block" id="FF_smoothed_delta_ring_themage.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_smoothed_delta_ring_themage.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameter labels to be used in plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          plabels (list): list of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">pll</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;$\delta I_{</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">}$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="p">)</span>

        <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta F~({\rm Jy})$&#39;</span><span class="p">)</span>
        <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta d~(\mu{\rm as})$&#39;</span><span class="p">)</span>
        <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta w~(\mu{\rm as})$&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pll</span></div></div>

    
<div class="viewcode-block" id="FF_thick_mring"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_thick_mring">[docs]</a><span class="k">class</span> <span class="nc">FF_thick_mring</span><span class="p">(</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FisherForecast object for an m-ring model (based on ehtim).</span>
<span class="sd">    Parameter vector is:</span>
<span class="sd">      p[0] ... DOM, PLEASE FILL THIS IN.</span>

<span class="sd">    Args:</span>
<span class="sd">      m (int): Stokes I azimuthal Fourier series order.</span>
<span class="sd">      mp (int): Linear polarization azimuthal Fourier series order. Only used if stokes==&#39;full&#39;. Default: None.</span>
<span class="sd">      mc (int): Circular polarization azimuthal Fourier series order. Only used if stokes==&#39;full&#39;. Default: None.</span>
<span class="sd">      stokes (str): Indicates if this is limited to Stokes I (&#39;I&#39;) or include full polarization (&#39;full&#39;). Default: &#39;I&#39;.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      m (int): Stokes I azimuthal Fourier series order.</span>
<span class="sd">      mp (int): Linear polarization azimuthal Fourier series order. Only used if stokes==&#39;full&#39;.</span>
<span class="sd">      mc (int): Circular polarization azimuthal Fourier series order. Only used if stokes==&#39;full&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">mp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">mc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">stokes</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mp</span> <span class="o">=</span> <span class="n">mp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="o">=</span> <span class="n">mc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="n">stokes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">m</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mp</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span>

<div class="viewcode-block" id="FF_thick_mring.param_wrapper"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_thick_mring.param_wrapper">[docs]</a>    <span class="k">def</span> <span class="nf">param_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts parameters from a flattened list to an ehtim-style dictionary.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">          p (float): Parameter list as used by FisherForecast.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">          params (dict): Dictionary containing parameter values as used by ehtim.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># convert unwrapped parameter list to ehtim-readable version</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;F0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">beta_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex&quot;</span><span class="p">)</span>
        <span class="n">ind_start</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
            <span class="n">beta_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">ind_start</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mi">1</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="n">ind_start</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)])</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beta_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta_list</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">beta_list_pol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mp</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex&quot;</span><span class="p">)</span>
                <span class="n">ind_start</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">beta_list</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mp</span><span class="p">):</span>
                    <span class="n">beta_list_pol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">ind_start</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mi">1</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="n">ind_start</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)])</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beta_list_pol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta_list_pol</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beta_list_pol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">beta_list_cpol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex&quot;</span><span class="p">)</span>
                <span class="n">ind_start</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">beta_list_pol</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">):</span>
                    <span class="n">beta_list_cpol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">ind_start</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mi">1</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="n">ind_start</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)])</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beta_list_cpol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta_list_cpol</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beta_list_cpol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">params</span></div>

<div class="viewcode-block" id="FF_thick_mring.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_thick_mring.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibilities associated with m-ring model.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          V (np.array): list of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Takes:</span>
        <span class="c1"># p[0] ... total flux of the ring (Jy), which is also beta_0.</span>
        <span class="c1"># p[1] ... ring diameter (radians)</span>
        <span class="c1"># p[2] ... ring thickness (FWHM of Gaussian convolution) (radians)</span>
        <span class="c1"># p[...] ... beta list; list of complex Fourier coefficients, [beta_1, beta_2, ..., beta_m]</span>
        <span class="c1">#          Negative indices are determined by the condition beta_{-m} = beta_m*.</span>
        <span class="c1">#          Indices are all scaled by F0 = beta_0, so they are dimensionless.</span>
        <span class="c1"># p[...] ... beta list for linear polarization (if present)</span>
        <span class="c1">#          list of complex Fourier coefficients, [beta_{-mp}, beta_{-mp+1}, ..., beta_{mp-1}, beta_{mp}]</span>
        <span class="c1"># p[...] ... beta list for circular polarization (if present)</span>
        <span class="c1">#          list of complex Fourier coefficients, [beta_{-mc}, beta_{-mc+1}, ..., beta_{mc-1}, beta_{mc}]</span>

        <span class="c1"># set up parameter dictionary for ehtim</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_wrapper</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="c1"># read (u,v)-coordinates</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>

        <span class="c1"># compute model visibilities</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="n">vis</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">vis</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vis_RR</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;RR&#39;</span><span class="p">)</span>
            <span class="n">vis_LL</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;LL&#39;</span><span class="p">)</span>
            <span class="n">vis_RL</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;RL&#39;</span><span class="p">)</span>
            <span class="n">vis_LR</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;LR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">vis_RR</span><span class="p">,</span> <span class="n">vis_LL</span><span class="p">,</span> <span class="n">vis_RL</span><span class="p">,</span> <span class="n">vis_LR</span></div>
        
<div class="viewcode-block" id="FF_thick_mring.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_thick_mring.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibility gradients associated with m-ring model.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          gradV (np.array): list of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Takes:</span>
        <span class="c1"># p[0] ... total flux of the ring (Jy), which is also beta_0.</span>
        <span class="c1"># p[1] ... ring diameter (radians)</span>
        <span class="c1"># p[2] ... ring thickness (FWHM of Gaussian convolution) (radians)</span>
        <span class="c1"># p[...] ... beta list; list of complex Fourier coefficients, [beta_1, beta_2, ..., beta_m]</span>
        <span class="c1">#          Negative indices are determined by the condition beta_{-m} = beta_m*.</span>
        <span class="c1">#          Indices are all scaled by F0 = beta_0, so they are dimensionless.</span>
        <span class="c1"># p[...] ... beta list for linear polarization (if present)</span>
        <span class="c1">#          list of complex Fourier coefficients, [beta_{-mp}, beta_{-mp+1}, ..., beta_{mp-1}, beta_{mp}]</span>
        <span class="c1"># p[...] ... beta list for circular polarization (if present)</span>
        <span class="c1">#          list of complex Fourier coefficients, [beta_{-mc}, beta_{-mc+1}, ..., beta_{mc-1}, beta_{mc}]</span>

        <span class="c1"># set up parameter dictionary for ehtim</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_wrapper</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="c1"># read (u,v)-coordinates</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>

        <span class="c1"># compute model gradients</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="n">grad</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_grad_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">fit_pol</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">fit_cpol</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            
            <span class="c1"># unit conversion</span>
            <span class="n">grad</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>
            <span class="n">grad</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>

            <span class="c1"># remove (x0,y0) parameters</span>
            <span class="n">grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">grad</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">grad</span><span class="p">[</span><span class="mi">5</span><span class="p">:,</span> <span class="p">:]))</span>
            
            <span class="k">return</span> <span class="n">grad</span><span class="o">.</span><span class="n">T</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">grad_RR</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_grad_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;RR&#39;</span><span class="p">,</span><span class="n">fit_pol</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">fit_cpol</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">grad_LL</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_grad_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;LL&#39;</span><span class="p">,</span><span class="n">fit_pol</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">fit_cpol</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">grad_RL</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_grad_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;RL&#39;</span><span class="p">,</span><span class="n">fit_pol</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">fit_cpol</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">grad_LR</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_grad_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;LR&#39;</span><span class="p">,</span><span class="n">fit_pol</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">fit_cpol</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
            <span class="c1"># unit conversion</span>
            <span class="n">grad_RR</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>
            <span class="n">grad_RR</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>

            <span class="n">grad_LL</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>
            <span class="n">grad_LL</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>

            <span class="n">grad_RL</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>
            <span class="n">grad_RL</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>

            <span class="n">grad_LR</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>
            <span class="n">grad_LR</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>

            <span class="c1"># remove (x0,y0) parameters</span>
            <span class="n">grad_RR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">grad_RR</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">grad_RR</span><span class="p">[</span><span class="mi">5</span><span class="p">:,</span> <span class="p">:]))</span>
            <span class="n">grad_LL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">grad_LL</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">grad_LL</span><span class="p">[</span><span class="mi">5</span><span class="p">:,</span> <span class="p">:]))</span>
            <span class="n">grad_RL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">grad_RL</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">grad_RL</span><span class="p">[</span><span class="mi">5</span><span class="p">:,</span> <span class="p">:]))</span>
            <span class="n">grad_LR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">grad_LR</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">grad_LR</span><span class="p">[</span><span class="mi">5</span><span class="p">:,</span> <span class="p">:]))</span>

            <span class="k">return</span> <span class="n">grad_RR</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">grad_LL</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">grad_RL</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">grad_LR</span><span class="o">.</span><span class="n">T</span></div>

<div class="viewcode-block" id="FF_thick_mring.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_thick_mring.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameter labels to be used in plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          plabels (list): list of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta F~({\rm Jy})$&#39;</span><span class="p">)</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta d~(\mu{\rm as})$&#39;</span><span class="p">)</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta \alpha~(\mu{\rm as})$&#39;</span><span class="p">)</span>
        <span class="c1"># labels.append(r&#39;$\delta x_0~(\mu{\rm as})$&#39;)</span>
        <span class="c1"># labels.append(r&#39;$\delta y_0~(\mu{\rm as})$&#39;)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta |\beta_{m=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}|$&#39;</span><span class="p">)</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta {\rm arg}\beta_{m=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}$&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mp</span><span class="p">):</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta |\beta_{mp=-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mp</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}|$&#39;</span><span class="p">)</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta {\rm arg}\beta_{mp=-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mp</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}$&#39;</span><span class="p">)</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta |\beta_{mp=0}|$&#39;</span><span class="p">)</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta {\rm arg}\beta_{mp=0}$&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mp</span><span class="p">):</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta |\beta_{mp=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}|$&#39;</span><span class="p">)</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta {\rm arg}\beta_{mp=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}$&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">):</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta |\beta_{mc=-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}|$&#39;</span><span class="p">)</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta {\rm arg}\beta_{mc=-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}$&#39;</span><span class="p">)</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta |\beta_{mc=0}|$&#39;</span><span class="p">)</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta {\rm arg}\beta_{mc=0}$&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">):</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta |\beta_{mc=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}|$&#39;</span><span class="p">)</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta {\rm arg}\beta_{mc=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}$&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">labels</span></div></div>
    
<div class="viewcode-block" id="FF_sum"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_sum">[docs]</a><span class="k">class</span> <span class="nc">FF_sum</span><span class="p">(</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FisherForecast object constructed from the sum of multiple </span>
<span class="sd">    FisherForecast objects. For example, a binary might be generated from</span>
<span class="sd">    the sum of two Gaussians.  </span>

<span class="sd">    The parameter vector is constructed from the concatenation of the parameter</span>
<span class="sd">    vectors from each individual object, with all objects after the first</span>
<span class="sd">    gaining a pair of offset parameters.  That is:</span>
<span class="sd">      p[0] ............ Obj1 p[0]</span>
<span class="sd">      p[1] ............ Obj1 p[1]</span>
<span class="sd">        ...</span>
<span class="sd">      p[n1] ........... Obj2 p[0]</span>
<span class="sd">      p[n1+1] ......... Obj2 p[0]</span>
<span class="sd">        ...</span>
<span class="sd">      p[n1+n2] ........ Obj2 dx</span>
<span class="sd">      p[n1+n2+1] ...... Obj2 dy</span>
<span class="sd">      p[n1+n2+2] ...... Obj3 p[0]</span>
<span class="sd">        ...</span>
<span class="sd">      p[n1+n2+n3+2] ... Obj3 dx</span>
<span class="sd">      p[n1+n2+n3+3] ... Obj3 dy</span>
<span class="sd">        ...</span>
<span class="sd">    Prior lists are constructed similarly.</span>
<span class="sd">    </span>

<span class="sd">    Args:</span>
<span class="sd">      ff_list (list): List of FisherForecast objects to be summed. Additional objects can be added later. Default: None.</span>
<span class="sd">      stokes (str): Indicates if this is limited to Stokes I (&#39;I&#39;) or include full polarization (&#39;full&#39;). Default: &#39;I&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ff_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">stokes</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ff_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="n">stokes</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ff_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ff_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ff_list</span><span class="p">)</span> <span class="c1"># This is a SHALLOW copy</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ff_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">ff_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
            <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ff_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ff_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">ff_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ff_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">+</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">])</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ff_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ff_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="n">ff_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stokes</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ff_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span><span class="p">):</span>
                            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The model components in FF_sum do not have the same stokes type!&#39;</span><span class="p">))</span>

<div class="viewcode-block" id="FF_sum.add"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_sum.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ff</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a FisherForecast object to the sum.</span>

<span class="sd">        Args:</span>
<span class="sd">          ff (FisherForecast): An existing FisherForecast object to add.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ff_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_list</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="n">ff</span><span class="o">.</span><span class="n">size</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">2</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_list</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="o">*</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_list</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="o">+</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">])</span></div>
                
            
            
<div class="viewcode-block" id="FF_sum.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_sum.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibilities associated with the summed model.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          V (np.array): list of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">):</span>
            <span class="n">V</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_list</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="p">:(</span><span class="n">k</span><span class="o">+</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">shift_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="n">k</span> <span class="o">+=</span> <span class="n">ff</span><span class="o">.</span><span class="n">size</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="n">dx</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
                    <span class="n">dy</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">shift_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span><span class="o">*</span><span class="n">uas2rad</span> <span class="p">)</span>
                    <span class="n">k</span> <span class="o">+=</span> <span class="n">ff</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">2</span>
                    
                <span class="n">V</span> <span class="o">=</span> <span class="n">V</span> <span class="o">+</span> <span class="n">ff</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span> <span class="o">*</span> <span class="n">shift_factor</span>
            <span class="k">return</span> <span class="n">V</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">RR</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
            <span class="n">LL</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
            <span class="n">RL</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
            <span class="n">LR</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_list</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="p">:(</span><span class="n">k</span><span class="o">+</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">shift_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="n">k</span> <span class="o">+=</span> <span class="n">ff</span><span class="o">.</span><span class="n">size</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="n">dx</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
                    <span class="n">dy</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">shift_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span><span class="o">*</span><span class="n">uas2rad</span> <span class="p">)</span>
                    <span class="n">k</span> <span class="o">+=</span> <span class="n">ff</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">2</span>
                    
                <span class="n">RR_prev</span><span class="p">,</span> <span class="n">LL_prev</span><span class="p">,</span> <span class="n">RL_prev</span><span class="p">,</span> <span class="n">LR_prev</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
                <span class="n">RR</span> <span class="o">+=</span> <span class="n">RR_prev</span> <span class="o">*</span> <span class="n">shift_factor</span>
                <span class="n">LL</span> <span class="o">+=</span> <span class="n">LL_prev</span> <span class="o">*</span> <span class="n">shift_factor</span>
                <span class="n">RL</span> <span class="o">+=</span> <span class="n">RL_prev</span> <span class="o">*</span> <span class="n">shift_factor</span>
                <span class="n">LR</span> <span class="o">+=</span> <span class="n">LR_prev</span> <span class="o">*</span> <span class="n">shift_factor</span>

            <span class="k">return</span> <span class="n">RR</span><span class="p">,</span> <span class="n">LL</span><span class="p">,</span> <span class="n">RL</span><span class="p">,</span> <span class="n">LR</span></div>

<div class="viewcode-block" id="FF_sum.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_sum.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibility gradients associated with the summed model.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (np.array): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          gradV (np.array): list of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
        <span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">):</span>
            <span class="n">gradV</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_list</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="p">:(</span><span class="n">k</span><span class="o">+</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">shift_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="n">k</span> <span class="o">+=</span> <span class="n">ff</span><span class="o">.</span><span class="n">size</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="n">dx</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
                    <span class="n">dy</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">V</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
                    <span class="n">shift_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span><span class="o">*</span><span class="n">uas2rad</span> <span class="p">)</span>
                    <span class="n">k</span> <span class="o">+=</span> <span class="n">ff</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">2</span>
                
                <span class="k">for</span> <span class="n">gV</span> <span class="ow">in</span> <span class="n">ff</span><span class="o">.</span><span class="n">visibility_gradients</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="p">:</span>
                    <span class="n">gradV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">gV</span><span class="o">*</span><span class="n">shift_factor</span> <span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">gradV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">shift_factor</span><span class="o">*</span><span class="n">V</span><span class="o">*</span><span class="n">uas2rad</span><span class="p">)</span>
                    <span class="n">gradV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">v</span><span class="o">*</span><span class="n">shift_factor</span><span class="o">*</span><span class="n">V</span><span class="o">*</span><span class="n">uas2rad</span><span class="p">)</span>

            <span class="n">gradV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradV</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">gradV</span><span class="o">.</span><span class="n">T</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">gradRR</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">gradLL</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">gradRL</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">gradLR</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_list</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="p">:(</span><span class="n">k</span><span class="o">+</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">shift_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="n">k</span> <span class="o">+=</span> <span class="n">ff</span><span class="o">.</span><span class="n">size</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="n">dx</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
                    <span class="n">dy</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">RR</span><span class="p">,</span><span class="n">LL</span><span class="p">,</span><span class="n">RL</span><span class="p">,</span><span class="n">LR</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
                    <span class="n">shift_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span><span class="o">*</span><span class="n">uas2rad</span> <span class="p">)</span>
                    <span class="n">k</span> <span class="o">+=</span> <span class="n">ff</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">2</span>
                
                <span class="n">gradRR_prev</span><span class="p">,</span> <span class="n">gradLL_prev</span><span class="p">,</span> <span class="n">gradRL_prev</span><span class="p">,</span> <span class="n">gradLR_prev</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">visibility_gradients</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
                
                <span class="c1"># gradRR = gradRR_prev.T*shift_factor</span>
                <span class="c1"># gradLL = gradLL_prev.T*shift_factor</span>
                <span class="c1"># gradRL = gradRL_prev.T*shift_factor</span>
                <span class="c1"># gradLR = gradLR_prev.T*shift_factor</span>

                <span class="k">for</span> <span class="n">gRR</span> <span class="ow">in</span> <span class="n">gradRR_prev</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
                    <span class="n">gradRR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gRR</span><span class="o">*</span><span class="n">shift_factor</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">gLL</span> <span class="ow">in</span> <span class="n">gradLL_prev</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
                    <span class="n">gradLL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gLL</span><span class="o">*</span><span class="n">shift_factor</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">gRL</span> <span class="ow">in</span> <span class="n">gradRL_prev</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
                    <span class="n">gradRL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gRL</span><span class="o">*</span><span class="n">shift_factor</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">gLR</span> <span class="ow">in</span> <span class="n">gradLR_prev</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
                    <span class="n">gradLR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gLR</span><span class="o">*</span><span class="n">shift_factor</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="c1"># gRR_shift = np.array([-2.0j*np.pi*u*shift_factor*RR*uas2rad,-2.0j*np.pi*v*shift_factor*RR*uas2rad])</span>
                    <span class="c1"># gLL_shift = np.array([-2.0j*np.pi*u*shift_factor*LL*uas2rad,-2.0j*np.pi*v*shift_factor*LL*uas2rad])</span>
                    <span class="c1"># gRL_shift = np.array([-2.0j*np.pi*u*shift_factor*RL*uas2rad,-2.0j*np.pi*v*shift_factor*RL*uas2rad])</span>
                    <span class="c1"># gLR_shift = np.array([-2.0j*np.pi*u*shift_factor*LR*uas2rad,-2.0j*np.pi*v*shift_factor*LR*uas2rad])</span>

                    <span class="c1"># gradRR = np.concatenate((gradRR,gRR_shift))</span>
                    <span class="c1"># gradLL = np.concatenate((gradLL,gLL_shift))</span>
                    <span class="c1"># gradRL = np.concatenate((gradRL,gRL_shift))</span>
                    <span class="c1"># gradLR = np.concatenate((gradLR,gLR_shift))</span>

                    <span class="n">gradRR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">shift_factor</span><span class="o">*</span><span class="n">RR</span><span class="o">*</span><span class="n">uas2rad</span><span class="p">)</span>
                    <span class="n">gradRR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">v</span><span class="o">*</span><span class="n">shift_factor</span><span class="o">*</span><span class="n">RR</span><span class="o">*</span><span class="n">uas2rad</span><span class="p">)</span>
                    <span class="n">gradLL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">shift_factor</span><span class="o">*</span><span class="n">LL</span><span class="o">*</span><span class="n">uas2rad</span><span class="p">)</span>
                    <span class="n">gradLL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">v</span><span class="o">*</span><span class="n">shift_factor</span><span class="o">*</span><span class="n">LL</span><span class="o">*</span><span class="n">uas2rad</span><span class="p">)</span>
                    <span class="n">gradRL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">shift_factor</span><span class="o">*</span><span class="n">RL</span><span class="o">*</span><span class="n">uas2rad</span><span class="p">)</span>
                    <span class="n">gradRL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">v</span><span class="o">*</span><span class="n">shift_factor</span><span class="o">*</span><span class="n">RL</span><span class="o">*</span><span class="n">uas2rad</span><span class="p">)</span>
                    <span class="n">gradLR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">shift_factor</span><span class="o">*</span><span class="n">LR</span><span class="o">*</span><span class="n">uas2rad</span><span class="p">)</span>
                    <span class="n">gradLR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">v</span><span class="o">*</span><span class="n">shift_factor</span><span class="o">*</span><span class="n">LR</span><span class="o">*</span><span class="n">uas2rad</span><span class="p">)</span>

            <span class="n">gradRR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradRR</span><span class="p">)</span>
            <span class="n">gradLL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradLL</span><span class="p">)</span>
            <span class="n">gradRL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradRL</span><span class="p">)</span>
            <span class="n">gradLR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradLR</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">gradRR</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">gradLL</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">gradRL</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">gradLR</span><span class="o">.</span><span class="n">T</span></div>
                
<div class="viewcode-block" id="FF_sum.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FF_sum.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameter labels to be used in plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          plabels (list): list of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">pll</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff_list</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">ff</span><span class="o">.</span><span class="n">parameter_labels</span><span class="p">()</span> <span class="p">:</span>
                <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta\Delta x~(\mu{\rm as})$&#39;</span><span class="p">)</span>
                <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta\Delta y~(\mu{\rm as})$&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">pll</span></div></div>


            

    




<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span> <span class="p">:</span>

    <span class="c1"># Example</span>
    
    <span class="c1"># Make Fisher forecast object</span>
    <span class="n">ff1</span> <span class="o">=</span> <span class="n">FF_splined_raster</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">ff2</span> <span class="o">=</span> <span class="n">FF_smoothed_delta_ring</span><span class="p">()</span>
    <span class="n">ff</span> <span class="o">=</span> <span class="n">FF_sum</span><span class="p">([</span><span class="n">ff1</span><span class="p">,</span><span class="n">ff2</span><span class="p">])</span>

    <span class="c1"># Read in some data</span>
    <span class="n">obs_ngeht</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">obsdata</span><span class="o">.</span><span class="n">load_uvfits</span><span class="p">(</span><span class="s1">&#39;../data/M87_230GHz_40uas.uvfits&#39;</span><span class="p">)</span>
    <span class="n">obs_ngeht</span><span class="o">.</span><span class="n">add_scans</span><span class="p">()</span>
    <span class="n">obs_ngeht</span> <span class="o">=</span> <span class="n">obs_ngeht</span><span class="o">.</span><span class="n">avg_coherent</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">scan_avg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">obs_ngeht</span> <span class="o">=</span> <span class="n">obs_ngeht</span><span class="o">.</span><span class="n">add_fractional_noise</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">obs_ngeht</span><span class="o">.</span><span class="n">flag_sites</span><span class="p">([</span><span class="s1">&#39;ALMA&#39;</span><span class="p">,</span><span class="s1">&#39;APEX&#39;</span><span class="p">,</span><span class="s1">&#39;JCMT&#39;</span><span class="p">,</span><span class="s1">&#39;SMA&#39;</span><span class="p">,</span><span class="s1">&#39;SMT&#39;</span><span class="p">,</span><span class="s1">&#39;LMT&#39;</span><span class="p">,</span><span class="s1">&#39;SPT&#39;</span><span class="p">,</span><span class="s1">&#39;PV&#39;</span><span class="p">,</span><span class="s1">&#39;PDB&#39;</span><span class="p">,</span><span class="s1">&#39;KP&#39;</span><span class="p">])</span>


    <span class="n">obslist</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="p">,</span><span class="n">obs_ngeht</span><span class="p">]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ngEHT w/o EHT&#39;</span><span class="p">,</span><span class="s1">&#39;Full ngEHT&#39;</span><span class="p">]</span>
    
    
    <span class="c1"># Choose a default image</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="n">rad2uas</span> <span class="o">=</span> <span class="mf">3600e6</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ff1</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ff1</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">ff1</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span>  <span class="o">-</span><span class="p">((</span><span class="n">ff1</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="mf">5.0</span><span class="o">/</span><span class="n">rad2uas</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ff1</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">rad2uas</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="mf">25.0</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mf">25.0</span><span class="o">/</span><span class="n">rad2uas</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="c1"># 1D Diameter</span>
    <span class="n">plot_1d_forecast</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="n">obslist</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;ring_forecast_1d.png&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="c1"># 2D diameter vs width</span>
    <span class="n">plot_2d_forecast</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="n">ff</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">obslist</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;ring_forecast_2d.png&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="c1"># Triangle</span>
    <span class="n">plist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
    <span class="n">plot_triangle_forecast</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">plist</span><span class="p">,</span><span class="n">obslist</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;ring_forecast_tri.png&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    
    <span class="c1"># plt.show()</span>

</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Avery E. Broderick.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0+untagged.63.g94a6842.dirty',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            LINK_SUFFIX:'.html', 
            HAS_SOURCE: 'true'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>